"use strict";function Events(){}function EE(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function EventEmitter(){this._events=new Events,this._eventsCount=0}function Stage(a){EventEmitter.call(this),this.adapter=a.adapter,this.adapter||isNode||(this.adapter=new WebAdapter),this.adapter.stage=this;var b=a&&a.w,c=a&&a.h;b&&c||(b=1280,c=720),this.w=b,this.h=c,this.reuseCanvas=a&&a.reuseCanvas||null,this.renderWidth=a&&a.rw||this.w,this.renderHeight=a&&a.rh||this.h,this.textureMemory=a&&a.textureMemory||12e6,a&&a.hasOwnProperty("glClearColor")?this.setGlClearColor(a.glClearColor):this.setGlClearColor(this.adapter.glClearColor||[0,0,0,0]),this.defaultFontFace=a&&a.defaultFontFace||"Arial",this.defaultPrecision=a&&a.defaultPrecision||this.h/this.renderHeight,this.fixedDt=a&&a.fixedDt||0,this.frameCounter=0,this.useTextureAtlas=!(!a||!a.hasOwnProperty("useTextureAtlas"))&&a.useTextureAtlas,this.useTextureAtlas&&console.log("Using texture atlas."),this.debugTextureAtlas=!!(this.useTextureAtlas&&a&&a.hasOwnProperty("debugTextureAtlas"))&&a.debugTextureAtlas,this.debugTextureAtlas&&console.log("Showing texture atlas for debug."),this.renderer=new Renderer(this,b,c),this.textureManager=new TextureManager(this,this.renderer.gl),this.textureAtlas=this.useTextureAtlas?new TextureAtlas(this,this.renderer.gl):null,this.state=Stage.STATES.IDLE,this.root=this.c(),this.root.active=!0,this.root.setAsRoot(),this.dt=0,this.activeTransitions=new Set,this.activeAnimations=new Set,this.measure=!!a.measure,this.measureDetails=!!a.measureDetails,this.measureStart={},this.measureTotalMs={},this.measureMs={},this.measureLastFrameCounter={},this.measureCount={},this.rectangleTexture=this.getTexture(Stage.rectangleSource.src,Stage.rectangleSource),this.adapter.setStage&&this.adapter.setStage(this),this.uComponentContext=this.adapter.getUComponentContext(),this.zIndexUsage=0,this.profile=new Array(60),this.innerProfile=new Array(10),this.profileLast=0,this.init(),this.destroyed=!1}function TextureManager(a,b){this.stage=a,this.gl=b,this.textureMemory=a.textureMemory,this.usedTextureMemory=0,this.uploadedTextureSources=[],this.textureSourceHashmap=new Map,this.textureSourceIdHashmap=new Map}function Texture(a,b){this.manager=a,this.id=++Texture.id,this.source=b,this._x=0,this._y=0,this._w=0,this._h=0,this.clipping=!1,this.components=new Set}function TextureAtlas(a,b){this.stage=a,this.w=2048,this.h=2048,this.activeTree=new TextureAtlasTree(this.w,this.h),this.activeTextureSources=new Set,this.addedTextureSources=new Set,this.wastedPixels=0,this.lastImportFrame=0,this.gl=b,this.vertexShaderSrc=["#ifdef GL_ES","precision lowp float;","#endif","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat4 projectionMatrix;","varying vec2 vTextureCoord;","void main(void){","    gl_Position = projectionMatrix * vec4(aVertexPosition, 0.0, 1.0);","    vTextureCoord = aTextureCoord;","}"].join("\n"),this.fragmentShaderSrc=["#ifdef GL_ES","precision lowp float;","#endif","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","void main(void){","    gl_FragColor = texture2D(uSampler, vTextureCoord);","}"].join("\n"),this.program=null,this.lastDefragFrame=0,this.pixelsLimit=this.w*this.h/32,this.minWastedPixels=this.w*this.h/8,this.defragNeeded=!1,this.uploads=[],this.projectionMatrix=new Float32Array([2/this.w,0,0,0,0,2/this.h,0,0,0,0,1,0,-1,-1,0,1]),this.initShaderProgram();var b=this.gl;if(this.texture=this.gl.createTexture(),b.bindTexture(b.TEXTURE_2D,this.texture),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,this.w,this.h,0,b.RGBA,b.UNSIGNED_BYTE,new Uint8Array(this.w*this.h*4)),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.bindTexture(b.TEXTURE_2D,null),this.framebuffer=b.createFramebuffer(),b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.texture,0),b.getError()!=b.NO_ERROR)throw"Some WebGL error occurred while trying to create framebuffer.";b.bindFramebuffer(b.FRAMEBUFFER,null);var c=b.getUniformLocation(this.program,"projectionMatrix");b.uniformMatrix4fv(c,!1,this.projectionMatrix)}function TextureAtlasTree(a,b){this.w=a,this.h=b,this.root={x:0,y:0,w:a,h:b},this.spaces=new Set([this.root]),this.maxH=b}function ComponentText(a){this.stage=a.stage,this.component=a,this.updatingTexture=!1,this.settings=new TextRendererSettings,this.texture=null,this.updateTexture()}function TextRenderer(a,b){this.stage=a,this.texture=null,this.settings=b,this.canvas=null,this.context=null}function Transition(a){EventEmitter.call(this),this._delay=0,this._duration=1,this.timingFunction="ease",this.delayLeft=0,this.p=1,this.startValue=a,this.targetValue=this.startValue}function PropertyTransition(a,b){this.component=a,this.property=b,this.setting=Component.SETTINGS[b],Transition.call(this,this.setting.g(this.component)),this.mergeFunction=this.setting.m,this.valueSetterFunction=this.setting.sf}function Animation(a){this.stage=a,this._subject=null,this.actions=[],this.p=0,this.duration=0}function AnimationAction(a){this.animation=a,this._tags=[],this._items=new AnimationActionItems(this),this._properties=[],this._resetValue=null,this.hasResetValue=!1,this.mergeFunction=null,this.tags=""}function Renderer(a,b,c){this.stage=a,this.w=b,this.h=c,this.gl=a.adapter.getWebGLRenderingContext(b,c),this.program=null,this.vertexShaderSrc=["#ifdef GL_ES","precision lowp float;","#endif","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat4 projectionMatrix;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","    gl_Position = projectionMatrix * vec4(aVertexPosition, 0.0, 1.0);","    vTextureCoord = aTextureCoord;","    vColor = aColor;","}"].join("\n"),this.fragmentShaderSrc=["#ifdef GL_ES","precision lowp float;","#endif","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","    gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"].join("\n"),this.projectionMatrix=new Float32Array([2/this.stage.renderWidth,0,0,0,0,-2/this.stage.renderHeight,0,0,0,0,1,0,-1,1,0,1]),this.paramsGlBuffer=null,this.program=null,this.vertexPositionAttribute=null,this.textureCoordAttribute=null,this.colorAttribute=null,this.indicesGlBuffer=null,this.frameCounter=0,this.initShaderProgram()}function List(a,b,c){EventEmitter.call(this),this.stage=a,this.component=this.stage.c(),this.index=this._index=0,this.wrapper=this.stage.c(),this.component.addChild(this.wrapper),this.reloadVisibleElements=!1,this.itemSize=this._itemSize=100,this.viewportScrollOffset=this._viewportScrollOffset=0,this.itemScrollOffset=this._itemScrollOffset=0,this.rollOver=this._rollOver=!0,this.wrap=this._wrap=!0,this.wrapMin=this._wrapMin=0,this.wrapMax=this._wrapMax=0,this._progressAnimation=null,this.invertDirection=this._invertDirection=!1,this.horizontal=!!b.horizontal,this.scrollTransition=this.wrapper.transition(this.horizontal?"x":"y",{}),this.visibleItems=new Set,this.prevValue=null,this.prevViewportSize=null,b&&this.set(b),c&&this.component.set(c),this.setup()}var has=Object.prototype.hasOwnProperty,prefix="~";Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)has.call(a,b)&&c.push(prefix?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},EventEmitter.prototype.listeners=function(a,b){var c=prefix?prefix+a:a,d=this._events[c];if(b)return!!d;if(!d)return[];if(d.fn)return[d.fn];for(var e=0,f=d.length,g=new Array(f);e<f;e++)g[e]=d[e].fn;return g},EventEmitter.prototype.emit=function(a,b,c,d,e,f){var g=prefix?prefix+a:a;if(!this._events[g])return!1;var h,i,j=this._events[g],k=arguments.length;if(j.fn){switch(j.once&&this.removeListener(a,j.fn,void 0,!0),k){case 1:return j.fn.call(j.context),!0;case 2:return j.fn.call(j.context,b),!0;case 3:return j.fn.call(j.context,b,c),!0;case 4:return j.fn.call(j.context,b,c,d),!0;case 5:return j.fn.call(j.context,b,c,d,e),!0;case 6:return j.fn.call(j.context,b,c,d,e,f),!0}for(i=1,h=new Array(k-1);i<k;i++)h[i-1]=arguments[i];j.fn.apply(j.context,h)}else{var l,m=j.length;for(i=0;i<m;i++)switch(j[i].once&&this.removeListener(a,j[i].fn,void 0,!0),k){case 1:j[i].fn.call(j[i].context);break;case 2:j[i].fn.call(j[i].context,b);break;case 3:j[i].fn.call(j[i].context,b,c);break;case 4:j[i].fn.call(j[i].context,b,c,d);break;default:if(!h)for(l=1,h=new Array(k-1);l<k;l++)h[l-1]=arguments[l];j[i].fn.apply(j[i].context,h)}}return!0},EventEmitter.prototype.on=function(a,b,c){var d=new EE(b,c||this),e=prefix?prefix+a:a;return this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],d]:this._events[e].push(d):(this._events[e]=d,this._eventsCount++),this},EventEmitter.prototype.once=function(a,b,c){var d=new EE(b,c||this,!0),e=prefix?prefix+a:a;return this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],d]:this._events[e].push(d):(this._events[e]=d,this._eventsCount++),this},EventEmitter.prototype.removeListener=function(a,b,c,d){var e=prefix?prefix+a:a;if(!this._events[e])return this;if(!b)return 0==--this._eventsCount?this._events=new Events:delete this._events[e],this;var f=this._events[e];if(f.fn)f.fn!==b||d&&!f.once||c&&f.context!==c||(0==--this._eventsCount?this._events=new Events:delete this._events[e]);else{for(var g=0,h=[],i=f.length;g<i;g++)(f[g].fn!==b||d&&!f[g].once||c&&f[g].context!==c)&&h.push(f[g]);h.length?this._events[e]=1===h.length?h[0]:h:0==--this._eventsCount?this._events=new Events:delete this._events[e]}return this},EventEmitter.prototype.removeAllListeners=function(a){var b;return a?(b=prefix?prefix+a:a,this._events[b]&&(0==--this._eventsCount?this._events=new Events:delete this._events[b])):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,"undefined"!=typeof module&&(module.exports=EventEmitter);var isNode=!("undefined"==typeof module||!module.exports),Utils={};Utils.extendClass=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.parentConstructor=b},Utils.isFunction=function(a){return"function"==typeof a},Utils.isNumber=function(a){return"number"==typeof a},Utils.isInteger=function(a){return"number"==typeof a&&a%1==0},Utils.isBoolean=function(a){return a===!0||a===!1},Utils.isString=function(a){return"string"==typeof a},Utils.isArray=Array.isArray,Utils.cloneObj=function(a){for(var b=Object.keys(a),c={},d=0;d<b.length;d++)c[b[d]]=a[b[d]];return c},Utils.merge=function(a,b){for(var c=Object.keys(b),d=0;d<c.length;d++)a[c[d]]=b[c[d]];return a},Utils.isObject=function(a){var b=typeof a;return!!a&&("object"==b||"function"==b)},Utils.isPlainObject=function(a){var b=typeof a;return!!a&&"object"==b},Utils.getArrayIndex=function(a,b){return Utils.getModuloIndex(a,b.length)},Utils.getModuloIndex=function(a,b){if(0==b)return a;for(;a<0;)a+=Math.ceil(-a/b)*b;return a%=b},Utils.getDeepClone=function(a){var b,c;if(Utils.isFunction(a))return a;if(Utils.isArray(a)){c=[];var d=Object.keys(a);for(b=0;b<d.length;b++)c[d[b]]=Utils.getDeepClone(a[d[b]]);return c}if(Utils.isObject(a)){c={};var d=Object.keys(a);for(b=0;b<d.length;b++)c[d[b]]=Utils.getDeepClone(a[d[b]]);return c}return a},Utils.setToArray=function(a){var b=[];return a.forEach(function(a){b.push(a)}),b},Utils.iteratorToArray=function(a){for(var b=[],c=a.next();!c.done;)b.push(c.value),c=a.next();return b},Utils.async={parallel:function(a,b){var c,d=a.length,e=!1,f=d,g=[];for(c=0;c<d;c++)!function(c){a[c](function(a,d){g[c]=d,a?e||(b(a),e=!0):0!=--f||e||(b(null,g),e=!0)})}(c)}},Utils.extendClass(Stage,EventEmitter),Stage.prototype.destroy=function(){this.adapter.stopAnimationLoop(),this.useTextureAtlas&&this.textureAtlas.destroy(),this.renderer.destroy(),this.textureManager.destroy(),this.destroyed=!0},Stage.prototype.setGlClearColor=function(a){Array.isArray(a)?this.glClearColor=a:this.glClearColor=StageUtils.getRgbaComponentsNormalized(a)},Stage.prototype.getCanvas=function(){return this.adapter.canvas},Stage.prototype.timeStart=function(a){this.measureCount[a]++,this.frameCounter!=this.measureLastFrameCounter[a]&&(this.measureLastFrameCounter[a]=this.frameCounter,this.measureTotalMs[a]+=this.measureMs[a],this.frameCounter%100==0&&(console.log(a+": "+(this.measureTotalMs[a]/100-("global"==a?4.5:0)).toFixed(3)+" ("+this.measureCount[a]/100+")"),this.measureTotalMs[a]=0,this.measureCount[a]=0),this.measureMs[a]=0),this.measureStart[a]=this.adapter.getHrTime()},Stage.prototype.timeEnd=function(a){var b=this.adapter.getHrTime();this.measureMs[a]+=b-this.measureStart[a]},Stage.prototype.stop=function(){this.adapter.stopAnimationLoop()},Stage.prototype.resume=function(){this.adapter.startAnimationLoop()},Stage.prototype.init=function(){this.adapter.init&&this.adapter.init();var a=this,b=this.getRectangleTexture(),c=b.source;c.onload=function(){a.adapter.startAnimationLoop(function(){a.drawFrame()}),c.permanent=!0,a.useTextureAtlas&&a.textureAtlas.add(c)},b.load()},Stage.prototype.getRectangleTexture=function(){return this.rectangleTexture},Stage.prototype.addActiveTransition=function(a){this.activeTransitions.add(a)},Stage.prototype.addActiveAnimation=function(a){this.activeAnimations.add(a)},Stage.prototype.drawFrame=function(){if(this.measure){var a=this.adapter.getHrTime();if(this.profileLast){var b=Math.max(Math.round((a-this.profileLast)/(3*16.6667))-1,0);if(b>19&&(b=19),this.profile[b]++,this.frameCounter%100==0){console.log("F "+this.profile.join(" "));for(var c=0;c<20;c++)this.profile[c]=0}}this.profileLast=a}if(this.measure&&this.timeStart("total"),this.fixedDt?this.dt=this.fixedDt:this.dt=this.startTime?.001*(this.currentTime-this.startTime):.02,this.startTime=this.currentTime,this.currentTime=(new Date).getTime(),this.measureDetails&&this.timeStart("frame start"),this._eventsCount&&this.emit("frameStart"),this.measureDetails&&this.timeEnd("frame start"),this.state=Stage.STATES.TRANSITIONS,a=this.adapter.getHrTime(),this.measureDetails&&this.timeStart("transitions"),this.progressTransitions(),this.measureDetails&&this.timeEnd("transitions"),this.state=Stage.STATES.ANIMATIONS,this.measureDetails&&this.timeStart("animations"),this.progressAnimations(),this.measureDetails&&this.timeEnd("animations"),this.measureDetails&&this.timeStart("update"),this.state=Stage.STATES.UPDATE,this._eventsCount&&this.emit("update"),this.measureDetails&&this.timeEnd("update"),this.textureManager.isFull()&&(console.log("clean up"),this.textureManager.freeUnusedTextureSources()),this.measureDetails&&this.timeStart("perform updates"),this.performUpdates(),this.measureDetails&&this.timeEnd("perform updates"),this.renderNeeded&&(this.measureDetails&&this.timeStart("render"),this.renderer.render(),this.measureDetails&&this.timeEnd("render")),this.state=Stage.STATES.IDLE,this.measureDetails&&this.timeStart("frame end"),this._eventsCount&&this.emit("frameEnd"),this.measureDetails&&this.timeEnd("frame end"),this.measure&&this.timeEnd("total"),this.adapter.nextFrame(this.renderNeeded),this.measure){a=this.adapter.getHrTime()-this.profileLast;var b=Math.max(Math.round(a/50.00001)-1,0);if(b>19&&(b=19),this.innerProfile[b]++,this.frameCounter%100==0){console.log("I "+this.innerProfile.join(" "));for(var c=0;c<20;c++)this.innerProfile[c]=0}}this.frameCounter++},Stage.prototype.progressTransitions=function(){var a=this;this.activeTransitions.size&&this.activeTransitions.forEach(function(b){b.component.attached&&b.isActive()?b.progress(a.dt):a.activeTransitions.delete(b)})},Stage.prototype.progressAnimations=function(){var a=this;this.activeAnimations.size&&this.activeAnimations.forEach(function(b){b.subject&&b.subject.attached&&b.isActive()?(b.progress(a.dt),b.applyTransforms()):a.activeAnimations.delete(b)})},Stage.prototype.performUpdates=function(){this.useTextureAtlas&&this.textureAtlas.flush();var a=this.adapter.getUComponentContext();this.renderNeeded=a.updateAndFillVbo(this.zIndexUsage>0)},Stage.prototype.getTexture=function(a,b){return this.textureManager.getTexture(a,b)},Stage.prototype.hasTexture=function(a){return this.textureManager.hasTexture(a)},Stage.prototype.component=function(a,b){var c=new Component(this);if(b)for(var d=0;d<b.length;d++)c.addChild(b[d]);return a&&c.set(a),c},Stage.prototype.c=function(a){var b=new Component(this);return a&&b.set(a),b},Stage.prototype.animation=function(a){var b=new TimedAnimation(this);return a&&b.set(a),b},Stage.STATES={IDLE:0,TRANSITIONS:1,ANIMATIONS:2,UPDATE:3,RENDER:4},Stage.componentId=0,Stage.rectangleSource={src:function(a){return a(new Uint8Array([255,255,255,255]),{w:1,h:1})},id:"__whitepix"},Stage.W=1280,Stage.H=720;var StageUtils={};StageUtils.mergeNumbers=function(a,b,c){return a*c+b*(1-c)},StageUtils.rgb=function(a,b,c){return(a<<16)+(b<<8)+c+4278190080},StageUtils.rgba=function(a,b,c,d){return(a<<16)+(b<<8)+c+16777216*(255*d|0)},StageUtils.getRgbaString=function(a){return"rgba("+(a/65536|0)%256+","+(a/256|0)%256+","+a%256+","+((a/16777216|0)/255).toFixed(4)+")"},StageUtils.getRgbaComponentsNormalized=function(a){return[(a/65536|0)%256*.003921569,(a/256|0)%256*.003921569,a%256*.003921569,.003921569*(a/16777216|0)]},StageUtils.getRgbaComponents=function(a){return[(a/65536|0)%256,(a/256|0)%256,a%256,a/16777216|0]},StageUtils.getArgbNumber=function(a){a[0]=Math.max(0,Math.min(255,a[0])),a[1]=Math.max(0,Math.min(255,a[1])),a[2]=Math.max(0,Math.min(255,a[2])),a[3]=Math.max(0,Math.min(255,a[3]));var b=((0|a[3])<<24)+((0|a[0])<<16)+((0|a[1])<<8)+(0|a[2]);return b<0&&(b=4294967295+b+1),b},StageUtils.mergeColors=function(a,b,c){return 16777216*((a/16777216|0)*c+(b/16777216|0)*(1-c)|0)+65536*((a/65536|0)%256*c+(b/65536|0)%256*(1-c)|0)+256*((a/256|0)%256*c+(b/256|0)%256*(1-c)|0)+(a%256*c+b%256*(1-c)|0)},StageUtils.mergeMultiColors=function(a,b){for(var c=0,d=0,e=0,f=0,g=0,h=a.length,i=0;i<h;i++){var j=(a[i]/65536|0)%256,k=(a[i]/256|0)%256,l=a[i]%256,m=a[i]/16777216|0;c+=j*b[i],d+=k*b[i],e+=l*b[i],f+=m*b[i],g+=b[i]}return g=1/g,16777216*(f*g|0)+65536*(c*g|0)+256*(d*g|0)+(e*g|0)},StageUtils.mergeMultiColorsEqual=function(a){for(var b=0,c=0,d=0,e=0,f=0,g=a.length,h=0;h<g;h++){var i=(a[h]/65536|0)%256,j=(a[h]/256|0)%256,k=a[h]%256,l=a[h]/16777216|0;b+=i,c+=j,d+=k,e+=l,f+=1}return f=1/f,16777216*(e*f|0)+65536*(b*f|0)+256*(c*f|0)+(d*f|0)},StageUtils.rad=function(a){return a*(Math.PI/180)},StageUtils.getTimingBezier=function(a,b,c,d){var e=3*a,f=3*(c-a)-e,g=1-e-f,h=3*b,i=3*(d-b)-h,j=1-h-i;return function(a){if(a>=1)return 1;if(a<=0)return 0;for(var b,c,d,k=.5,l=0;l<20;l++){if(b=k*(k*(k*g+f)+e),(d=a-b)>-1e-8&&d<1e-8)return k*(k*(k*j+i)+h);if((c=k*(k*(3*g)+2*f)+e)>1e-10&&c<1e-10)break;k+=d/c}var m=0,n=1;for(l=0;l<20;l++){if(k=.5*(m+n),b=k*(k*(k*g+f)+e),(d=a-b)>-1e-8&&d<1e-8)return k*(k*(k*j+i)+h);d<0?n=k:m=k}}},StageUtils.getTimingFunction=function(a){switch(a){case"linear":return function(a){return a};case"ease":return StageUtils.getTimingBezier(.25,.1,.25,1);case"ease-in":return StageUtils.getTimingBezier(.42,0,1,1);case"ease-out":return StageUtils.getTimingBezier(0,0,.58,1);case"ease-in-out":return StageUtils.getTimingBezier(.42,0,.58,1);case"step-start":return function(){return 1};case"step-end":return function(a){return 1===a?1:0};default:var b="cubic-bezier(";if(a&&0===a.indexOf(b)){var c=a.substr(b.length,a.length-b.length-1).split(",");if(4!==c.length)return console.warn("Unknown timing function: "+a),function(a){return a};var d=parseFloat(c[0]),e=parseFloat(c[1]),f=parseFloat(c[2]),g=parseFloat(c[3]);return isNaN(d)||isNaN(e)||isNaN(f)||isNaN(g)?(console.warn("Unknown timing function: "+a),function(a){return a}):StageUtils.getTimingBezier(d,e,f,g)}return console.warn("Unknown timing function: "+a),function(a){return a}}},StageUtils.getSplineValueFunction=function(a,b,c,d,e,f,g,h){var i=d-c;g*=i,h*=i;var j=StageUtils.getSplineHelpers(a,b,e,f,g,h);return j?function(c){return 0==c?a:1==c?b:StageUtils.calculateSpline(j,c)}:function(c){return 0==c?a:1==c?b:b*c+a*(1-c)}},StageUtils.getSplineRgbaValueFunction=function(a,b,c,d,e,f,g,h){var i=d-c;g[0]*=i,g[1]*=i,g[2]*=i,g[3]*=i,h[0]*=i,h[1]*=i,h[2]*=i,h[3]*=i;var j=StageUtils.getRgbaComponents(a),k=StageUtils.getRgbaComponents(b),l=[StageUtils.getSplineHelpers(j[0],k[0],e,f,g[0],h[0]),StageUtils.getSplineHelpers(j[1],k[1],e,f,g[1],h[1]),StageUtils.getSplineHelpers(j[2],k[2],e,f,g[2],h[2]),StageUtils.getSplineHelpers(j[3],k[3],e,f,g[3],h[3])];return l[0]?function(c){return 0==c?a:1==c?b:StageUtils.getArgbNumber([Math.min(255,StageUtils.calculateSpline(l[0],c)),Math.min(255,StageUtils.calculateSpline(l[1],c)),Math.min(255,StageUtils.calculateSpline(l[2],c)),Math.min(255,StageUtils.calculateSpline(l[3],c))])}:function(c){return 0==c?a:1==c?b:StageUtils.mergeColors(b,a,c)}},StageUtils.getSplineHelpers=function(a,b,c,d,e,f){if(!c&&!d)return null;var g=c,h=a+e*c,i=1-d,j=b-f*d;return[3*g-3*i+1,-6*g+3*i,3*g,3*h-3*j+b-a,3*(j+a)-6*h,3*(h-a),a]},StageUtils.calculateSpline=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6];if(c==-2&&f==-2&&0==e&&0==h)return b;for(var j,k,l=.5,m=0;m<20;m++){if(j=l*(l*(l*c+d)+e),(k=b-j)>-1e-8&&k<1e-8)return l*(l*(l*f+g)+h)+i;var n=l*(l*(3*c)+2*d)+e;if(n>1e-10&&n<1e-10)break;l+=k/n}var o=0,p=1;for(m=0;m<20;m++){if(l=.5*(o+p),j=l*(l*(l*c+d)+e),(k=b-j)>-1e-8&&k<1e-8)return l*(l*(l*f+g)+h)+i;k<0?p=l:o=l}return l};var GeometryUtils={};GeometryUtils.dotprod=function(a,b,c,d){return a*c+b*d},GeometryUtils.pointInConvex=function(a,b,c){var d,e,f,g;for(e=a.length,d=0;d<=a.length-2;d+=2)if(f=a[(d+2)%e]-a[d],g=a[(d+3)%e]-a[d+1],GeometryUtils.dotprod(b-a[d],c-a[d+1],-g,f)<=0)return!1;return!0},GeometryUtils.intersectConvex=function(a,b){var c,d,e,f;e=a.length;var g,h=b,i=!1;for(c=0;c<=e-2;c+=2){var j=a[(c+2)%e]-a[c],k=a[(c+3)%e]-a[c+1],l=Math.sqrt(j*j+k*k);j/=l,k/=l,f=h.length,g=[];var m,n,o,p,q;for(d=0;d<=f-2;d+=2){var r=h[d]-a[c],s=h[d+1]-a[c+1],t=GeometryUtils.dotprod(r,s,-k,j);if(q=t>=-1e-9,d>=2){if(p!=q){var u=GeometryUtils.dotprod(h[d-2]-a[c],h[d-1]-a[c+1],j,k),v=GeometryUtils.dotprod(r,s,j,k),w=(v-u)/(t-n),x=u-w*n,y=a[c]+x*j,z=a[c+1]+x*k;g.push(y,z),i=!0}}else o=q,m=t;if(q&&g.push(h[d],h[d+1]),d==f-2&&q!=o){var A=GeometryUtils.dotprod(h[0]-a[c],h[1]-a[c+1],j,k),v=GeometryUtils.dotprod(r,s,j,k),w=(v-A)/(t-m),x=A-w*m,y=a[c]+x*j,z=a[c+1]+x*k;g.push(y,z),i=!0}p=q,n=t}h=g}if(h.length)return i?h:b;var B=a[0],C=a[0],D=a[1],E=a[1],F=a[0],G=a[1];for(c=2;c<=e-2;c+=2)F+=a[c],G+=a[c+1],a[c]<B&&(B=a[c]),a[c]>C&&(C=a[c]),a[c+1]<D&&(D=a[c+1]),a[c+1]>E&&(E=a[c+1]);F/=.5*e,G/=.5*e;var H=b[0],I=b[0],J=b[1],K=b[1];f=b.length;var L=b[0],M=b[1];for(c=2;c<=f-2;c+=2)L+=b[c],M+=b[c+1],b[c]<H&&(H=b[c]),b[c]>I&&(I=b[c]),b[c+1]<J&&(J=b[c+1]),b[c+1]>K&&(K=b[c+1]);if(L/=.5*f,M/=.5*f,GeometryUtils.pointInConvex(b,F,G)){if(GeometryUtils.pointInConvex(a,L,M)){if(H<B||J<D||I>C||K>E)return a;if(H>B||J>D||I<C||K<E)return b;for(c=0;c<=e-2;c+=2)if(!GeometryUtils.pointInConvex(b,a[c],a[c+1]))return b;return a}return a}return GeometryUtils.pointInConvex(a,L,M)?b:[]},TextureManager.prototype.destroy=function(){for(var a=0,b=this.uploadedTextureSources.length;a<b;a++){var c=this.uploadedTextureSources[a];this.gl.deleteTexture(c.glTexture)}},TextureManager.prototype.getTexture=function(a,b){var c,d,e=b&&b.id||null,f=b&&b.x||0,g=b&&b.y||0,h=b&&b.w||0,i=b&&b.h||0;if(Utils.isString(a)){if(e=e||a,!(d=this.textureSourceHashmap.get(e))){var j=this,k=function(b){j.stage.adapter.loadTextureSourceString(a,b)};d=this.getTextureSource(k,e)}return c=new Texture(this,d),c.x=f,c.y=g,c.w=h,c.h=i,c.clipping=!!(f||g||h||i),c}return d=e?this.textureSourceHashmap.get(e):null,d||(a instanceof TextureSource?d=a:(d=this.getTextureSource(a,e),e&&this.textureSourceHashmap.set(e,d))),c=new Texture(this,d),c.x=f,c.y=g,c.w=h,c.h=i,c.clipping=!!(f||g||h||i),c},TextureManager.prototype.getTextureSource=function(a,b){var c=b?this.textureSourceHashmap.get(b):null;return c||(c=new TextureSource(this,a),b&&(c.lookupId=b,this.textureSourceHashmap.set(b,c))),c},TextureManager.prototype.loadTexture=function(a){var b=a.source;if(b.glTexture);else{var c=(new Date).getTime();if(b.loadingSince&&b.loadingSince>c-3e4);else{b.loadingSince=c;var d=this;!function(b){if(b.glTexture)return void(b.loadingSince=null);b.loadSource(function(c,e){if(!d.stage.destroyed)if(b.loadingSince=null,c instanceof TextureSource)a.replaceTextureSource(c),d.loadTexture(a);else if(!b.glTexture){if(c.width>2048||c.height>2048)return void console.error("Texture size too large: "+c.width+"x"+c.height+" (max allowed is 2048x2048)");b.w=c.width||e.w,b.h=c.height||e.h,b.precision=e.precision||1,e&&e.renderInfo&&(b.renderInfo=e.renderInfo),d.uploadTextureSource(b,c),b.isLoaded()}})}(b)}}},TextureManager.prototype.uploadTextureSource=function(a,b){if(!a.glTexture){var c=this.gl,d=c.createTexture();c.bindTexture(c.TEXTURE_2D,d),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.stage.adapter.uploadGlTexture(c,a,b),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),a.glTexture=d,this.usedTextureMemory+=a.w*a.h,this.uploadedTextureSources.push(a)}},TextureManager.prototype.isFull=function(){return this.usedTextureMemory>=this.textureMemory},TextureManager.prototype.freeUnusedTextureSources=function(){for(var a=[],b=this.usedTextureMemory,c=0,d=this.uploadedTextureSources.length;c<d;c++){var e=this.uploadedTextureSources[c];e.permanent||0!==e.components.size?a.push(e):this.freeTextureSource(e)}var f=this;this.textureSourceHashmap.forEach(function(a){a.permanent||0!==a.components.size||f.freeTextureSource(a)}),this.uploadedTextureSources=a,console.log("freed "+((b-this.usedTextureMemory)/1e6).toFixed(2)+"M texture pixels from GPU memory. Remaining: "+this.usedTextureMemory)},TextureManager.prototype.freeTextureSource=function(a){a.glTexture&&(this.usedTextureMemory-=a.w*a.h,this.gl.deleteTexture(a.glTexture),a.glTexture=null),a.loadingSince=null,a.lookupId&&this.textureSourceHashmap.delete(a.lookupId)},TextureManager.prototype.removeTextureSource=function(a){this.freeTextureSource(a),a.loadingSince=null,a.lookupId&&this.textureSourceHashmap.delete(a.lookupId)},Texture.prototype.addComponent=function(a){this.components.add(a),this.source.glTexture||this.manager.loadTexture(this)},Texture.prototype.removeComponent=function(a){this.components.delete(a)},Texture.prototype.enableClipping=function(a,b,c,d){this._x===a&&this._y===b&&this._w===c&&this._h===d||(this._x=a,this._y=b,this._w=c,this._h=d,this.updateClipping(!0))},Texture.prototype.disableClipping=function(){(this._x||this._y||this._w||this._h)&&(this._x=0,this._y=0,this._w=0,this._h=0,this.updateClipping(!1))},Texture.prototype.updateClipping=function(a){this.clipping=a===!0||a===!1?a:!!(this._x||this._y||this._w||this._h);var b=this;this.components.forEach(function(a){a.displayedTexture===b&&a.displayedTextureClippingChanged()})},Texture.prototype.replaceTextureSource=function(a){var b=new Set(this.components),c=this;b.forEach(function(a){a.texture===c?a.texture=null:a.displayedTexture===c&&(a.displayedTexture=null)}),this.source=a,b.forEach(function(b){null===b.texture?b.texture=c:a.glTexture&&(b.displayedTexture=c)})},Texture.prototype.load=function(){this.manager.loadTexture(this)},Texture.prototype.free=function(){this.manager.freeTextureSource(this.source)},Texture.prototype.set=function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=a[b[c]];this.setSetting(b[c],d)}},Texture.prototype.setSetting=function(a,b){var c=Texture.SETTINGS[a];c?c.s(this,b):console.warn("Unknown texture property: "+a)},Texture.prototype.getNonDefaults=function(){var a={};return 0!==this.x&&(a.x=this.x),0!==this.y&&(a.y=this.x),0!==this.w&&(a.w=this.x),0!==this.h&&(a.h=this.x),a},Object.defineProperty(Texture.prototype,"x",{get:function(){return this._x},set:function(a){this._x!==a&&(this._x=a,this.updateClipping())}}),Object.defineProperty(Texture.prototype,"y",{get:function(){return this._y},set:function(a){this._y!==a&&(this._y=a,this.updateClipping())}}),Object.defineProperty(Texture.prototype,"w",{get:function(){return this._w},set:function(a){this._w!==a&&(this._w=a,this.updateClipping())}}),Object.defineProperty(Texture.prototype,"h",{get:function(){return this._h},set:function(a){this._h!==a&&(this._h=a,this.updateClipping())}}),Texture.SETTINGS={x:{s:function(a,b){a.x=b},m:StageUtils.mergeNumbers},y:{s:function(a,b){a.y=b},m:StageUtils.mergeNumbers},w:{s:function(a,b){a.w=b},m:StageUtils.mergeNumbers},h:{s:function(a,b){a.h=b},m:StageUtils.mergeNumbers}},Texture.id=0;var TextureSource=function(a,b){this.manager=a,this.stage=a.stage,this.id=++TextureSource.id,this.lookupId=null,this.loadSource=b,this.loadingSince=null,this.inTextureAtlas=!1,this.textureAtlasX=0,this.textureAtlasY=0,this.w=0,this.h=0,this._precision=1,this.iprecision=1,this.glTexture=null,this.permanent=!1,this.components=new Set,this.onload=null,this.renderInfo=null};TextureSource.prototype.getRenderWidth=function(){return this.w/this.precision},TextureSource.prototype.getRenderHeight=function(){return this.h/this.precision},TextureSource.prototype.addComponent=function(a){this.components.add(a),this.glTexture&&this.stage.useTextureAtlas&&this.stage.textureAtlas.addActiveTextureSource(this),1===this.components.size&&(this.manager.textureSourceIdHashmap.set(this.id,this),this.lookupId&&(this.manager.textureSourceHashmap.has(this.lookupId)||this.manager.textureSourceHashmap.set(this.lookupId,this)))},TextureSource.prototype.removeComponent=function(a){this.components.size&&(this.components.delete(a),this.components.size||(this.stage.useTextureAtlas&&this.stage.textureAtlas.removeActiveTextureSource(this),this.manager.textureSourceIdHashmap.delete(this.id)))},TextureSource.prototype.isLoaded=function(){this.components.size&&this.stage.useTextureAtlas&&this.stage.textureAtlas.addActiveTextureSource(this),this.components.forEach(function(a){a.textureSourceIsLoaded()}),this.onload&&this.onload(),this.onload=null},TextureSource.prototype.isAddedToTextureAtlas=function(a,b){this.inTextureAtlas=!0,this.textureAtlasX=a,this.textureAtlasY=b,this.components.forEach(function(a){a.textureSourceIsAddedToTextureAtlas()})},TextureSource.prototype.isRemovedFromTextureAtlas=function(){this.inTextureAtlas=!1,this.components.forEach(function(a){a.textureSourceIsRemovedFromTextureAtlas()})},Object.defineProperty(TextureSource.prototype,"precision",{get:function(){return this._precision},set:function(a){this._precision=a,this.iprecision=1/a}}),TextureSource.id=0,TextureAtlas.prototype.destroy=function(){this.gl.deleteTexture(this.texture),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteBuffer(this.paramsGlBuffer),this.gl.deleteBuffer(this.indicesGlBuffer),this.gl.deleteProgram(this.program)},TextureAtlas.prototype.initShaderProgram=function(){var a=this.gl,b=this.glCompile(a.VERTEX_SHADER,this.vertexShaderSrc),c=this.glCompile(a.FRAGMENT_SHADER,this.fragmentShaderSrc);this.program=a.createProgram(),a.attachShader(this.program,b),a.attachShader(this.program,c),a.linkProgram(this.program),a.getProgramParameter(this.program,a.LINK_STATUS)||(console.error("Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",a.getProgramParameter(this.program,a.VALIDATE_STATUS)),console.error("gl.getError()",a.getError()),
""!==a.getProgramInfoLog(this.program)&&console.warn("Warning: gl.getProgramInfoLog()",a.getProgramInfoLog(this.program)),a.deleteProgram(this.program),this.program=null),a.useProgram(this.program),a.deleteShader(b),a.deleteShader(c),this.vertexPositionAttribute=a.getAttribLocation(this.program,"aVertexPosition"),this.textureCoordAttribute=a.getAttribLocation(this.program,"aTextureCoord"),this.paramsBuffer=new ArrayBuffer(576e3),this.allCoords=new Float32Array(this.paramsBuffer),this.allTexCoords=new Float32Array(this.paramsBuffer),this.allIndices=new Uint16Array(54e3);for(var d=0,e=0;d<54e3;d+=6,e+=4)this.allIndices[d]=e,this.allIndices[d+1]=e+1,this.allIndices[d+2]=e+2,this.allIndices[d+3]=e,this.allIndices[d+4]=e+2,this.allIndices[d+5]=e+3;this.indicesGlBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indicesGlBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.allIndices,a.STATIC_DRAW);var f=a.getUniformLocation(this.program,"projectionMatrix");a.uniformMatrix4fv(f,!1,this.projectionMatrix)},TextureAtlas.prototype.glCompile=function(a,b){var c=this.gl.createShader(a);return this.gl.shaderSource(c,b),this.gl.compileShader(c),this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)?c:(console.log(this.gl.getShaderInfoLog(c)),null)},TextureAtlas.prototype.uploadTextureSources=function(a){var b,c=a.length;for(c>1e3&&(c=1e3),b=0;b<c;b++){var d=a[b].w,e=a[b].h,f=a[b].textureAtlasX,g=a[b].textureAtlasY,h=1/d,i=1/e,j=16*b*9;this.allCoords[j+0]=f,this.allCoords[j+1]=g,this.allCoords[j+4]=f+d,this.allCoords[j+5]=g,this.allCoords[j+8]=f+d,this.allCoords[j+9]=g+e,this.allCoords[j+12]=f,this.allCoords[j+13]=g+e,this.allCoords[j+16]=f,this.allCoords[j+17]=g-1,this.allCoords[j+20]=f+d,this.allCoords[j+21]=g-1,this.allCoords[j+24]=f+d,this.allCoords[j+25]=g,this.allCoords[j+28]=f,this.allCoords[j+29]=g,this.allCoords[j+32]=f,this.allCoords[j+33]=g+e,this.allCoords[j+36]=f+d,this.allCoords[j+37]=g+e,this.allCoords[j+40]=f+d,this.allCoords[j+41]=g+e+1,this.allCoords[j+44]=f,this.allCoords[j+45]=g+e+1,this.allCoords[j+48]=f-1,this.allCoords[j+49]=g,this.allCoords[j+52]=f,this.allCoords[j+53]=g,this.allCoords[j+56]=f,this.allCoords[j+57]=g+e,this.allCoords[j+60]=f-1,this.allCoords[j+61]=g+e,this.allCoords[j+64]=f+d,this.allCoords[j+65]=g,this.allCoords[j+68]=f+d+1,this.allCoords[j+69]=g,this.allCoords[j+72]=f+d+1,this.allCoords[j+73]=g+e,this.allCoords[j+76]=f+d,this.allCoords[j+77]=g+e,this.allCoords[j+80]=f-1,this.allCoords[j+81]=g-1,this.allCoords[j+84]=f,this.allCoords[j+85]=g-1,this.allCoords[j+88]=f,this.allCoords[j+89]=g,this.allCoords[j+92]=f-1,this.allCoords[j+93]=g,this.allCoords[j+96]=f+d,this.allCoords[j+97]=g-1,this.allCoords[j+100]=f+d+1,this.allCoords[j+101]=g-1,this.allCoords[j+104]=f+d+1,this.allCoords[j+105]=g,this.allCoords[j+108]=f+d,this.allCoords[j+109]=g,this.allCoords[j+112]=f+d,this.allCoords[j+113]=g+e,this.allCoords[j+116]=f+d+1,this.allCoords[j+117]=g+e,this.allCoords[j+120]=f+d+1,this.allCoords[j+121]=g+e+1,this.allCoords[j+124]=f+d,this.allCoords[j+125]=g+e+1,this.allCoords[j+128]=f-1,this.allCoords[j+129]=g+e,this.allCoords[j+132]=f,this.allCoords[j+133]=g+e,this.allCoords[j+136]=f,this.allCoords[j+137]=g+e+1,this.allCoords[j+140]=f-1,this.allCoords[j+141]=g+e+1,this.allTexCoords[j+2]=0,this.allTexCoords[j+3]=0,this.allTexCoords[j+6]=1,this.allTexCoords[j+7]=0,this.allTexCoords[j+10]=1,this.allTexCoords[j+11]=1,this.allTexCoords[j+14]=0,this.allTexCoords[j+15]=1,this.allTexCoords[j+18]=0,this.allTexCoords[j+19]=0,this.allTexCoords[j+22]=1,this.allTexCoords[j+23]=0,this.allTexCoords[j+26]=1,this.allTexCoords[j+27]=i,this.allTexCoords[j+30]=0,this.allTexCoords[j+31]=i,this.allTexCoords[j+34]=0,this.allTexCoords[j+35]=1-i,this.allTexCoords[j+38]=1,this.allTexCoords[j+39]=1-i,this.allTexCoords[j+42]=1,this.allTexCoords[j+43]=1,this.allTexCoords[j+46]=0,this.allTexCoords[j+47]=1,this.allTexCoords[j+50]=0,this.allTexCoords[j+51]=0,this.allTexCoords[j+54]=h,this.allTexCoords[j+55]=0,this.allTexCoords[j+58]=h,this.allTexCoords[j+59]=1,this.allTexCoords[j+62]=0,this.allTexCoords[j+63]=1,this.allTexCoords[j+66]=1-h,this.allTexCoords[j+67]=0,this.allTexCoords[j+70]=1,this.allTexCoords[j+71]=0,this.allTexCoords[j+74]=1,this.allTexCoords[j+75]=1,this.allTexCoords[j+78]=1-h,this.allTexCoords[j+79]=1,this.allTexCoords[j+82]=0,this.allTexCoords[j+83]=0,this.allTexCoords[j+86]=h,this.allTexCoords[j+87]=0,this.allTexCoords[j+90]=h,this.allTexCoords[j+91]=i,this.allTexCoords[j+94]=0,this.allTexCoords[j+95]=i,this.allTexCoords[j+98]=1-h,this.allTexCoords[j+99]=0,this.allTexCoords[j+102]=1,this.allTexCoords[j+103]=0,this.allTexCoords[j+106]=1,this.allTexCoords[j+107]=i,this.allTexCoords[j+110]=1-h,this.allTexCoords[j+111]=i,this.allTexCoords[j+114]=1-h,this.allTexCoords[j+115]=1-i,this.allTexCoords[j+118]=1,this.allTexCoords[j+119]=1-i,this.allTexCoords[j+122]=1,this.allTexCoords[j+123]=1,this.allTexCoords[j+126]=1-h,this.allTexCoords[j+127]=1,this.allTexCoords[j+130]=0,this.allTexCoords[j+131]=1-i,this.allTexCoords[j+134]=h,this.allTexCoords[j+135]=1-i,this.allTexCoords[j+138]=h,this.allTexCoords[j+139]=1,this.allTexCoords[j+142]=0,this.allTexCoords[j+143]=1}var k=this.gl;k.bindFramebuffer(k.FRAMEBUFFER,this.framebuffer),k.useProgram(this.program),k.viewport(0,0,this.w,this.h),k.blendFunc(k.ONE,k.ZERO),k.enable(k.BLEND),k.disable(k.DEPTH_TEST),this.paramsGlBuffer=this.paramsGlBuffer||k.createBuffer(),k.bindBuffer(k.ARRAY_BUFFER,this.paramsGlBuffer);var l=new DataView(this.paramsBuffer,0,576*c);for(k.bufferData(k.ARRAY_BUFFER,l,k.DYNAMIC_DRAW),k.vertexAttribPointer(this.vertexPositionAttribute,2,k.FLOAT,!1,16,0),k.vertexAttribPointer(this.textureCoordAttribute,2,k.FLOAT,!1,16,8),k.enableVertexAttribArray(this.vertexPositionAttribute),k.enableVertexAttribArray(this.textureCoordAttribute),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,this.indicesGlBuffer),b=0;b<c;b++)k.bindTexture(k.TEXTURE_2D,a[b].glTexture),k.drawElements(k.TRIANGLES,54,k.UNSIGNED_SHORT,6*b*9*2);k.disableVertexAttribArray(this.vertexPositionAttribute),k.disableVertexAttribArray(this.textureCoordAttribute)},TextureAtlas.prototype.allocate=function(a){return this.activeTree.add(a)},TextureAtlas.prototype.addActiveTextureSource=function(a){1===a.id||a.w*a.h<this.pixelsLimit&&(this.activeTextureSources.has(a)||(this.activeTextureSources.add(a),this.addedTextureSources.has(a)||this.add(a)))},TextureAtlas.prototype.removeActiveTextureSource=function(a){if(this.activeTextureSources.has(a)){this.activeTextureSources.delete(a);var b=this.uploads.indexOf(a);b>=0&&(this.uploads.splice(b,1),a.isRemovedFromTextureAtlas(),this.addedTextureSources.delete(a)),this.addedTextureSources.has(a)&&(this.wastedPixels+=a.w*a.h)}},TextureAtlas.prototype.add=function(a){var b=this.allocate(a);return b?(this.addedTextureSources.add(a),a.isAddedToTextureAtlas(b.x+1,b.y+1),this.uploads.push(a),!0):(this.defragNeeded=!0,!1)},TextureAtlas.prototype.defragment=function(){console.log("defragment texture atlas");var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),a.viewport(0,0,this.w,this.h),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),this.activeTree.reset(),this.uploads=[],this.wastedPixels=0,this.lastDefragFrame=this.stage.frameCounter,this.defragNeeded=!1,this.addedTextureSources.forEach(function(a){a.isRemovedFromTextureAtlas()}),this.addedTextureSources.clear(),this.add(this.stage.rectangleTexture.source);var b=this;this.activeTextureSources.forEach(function(a){b.add(a)})},TextureAtlas.prototype.flush=function(){this.defragNeeded&&this.wastedPixels>=this.minWastedPixels&&this.lastDefragFrame<this.stage.frameCounter-300&&this.defragment(),this.uploads.length&&(this.lastImportFrame=this.stage.frameCounter,this.uploadTextureSources(this.uploads),this.uploads=[])},TextureAtlasTree.prototype.reset=function(){this.root={x:0,y:0,w:this.w,h:this.h},this.spaces=new Set([this.root]),this.maxH=this.h},TextureAtlasTree.prototype.add=function(a){var b=a.w+2,c=a.h+2;if(c>this.maxH)return!1;var d=0,e=null,f=0;return this.spaces.forEach(function(a){a.h>f&&(f=a.h),a.w>=b&&a.h>=c&&(!d||d>b*c)&&(d=b*c,e=a)}),this.maxH=f,!!e&&(this.useNode(e,a),e)},TextureAtlasTree.prototype.findNode=function(a,b,c){return a?a.o?this.findNode(a.r,b,c)||this.findNode(a.d,b,c):b<=a.w&&c<=a.h?a:null:null},TextureAtlasTree.prototype.useNode=function(a,b){var c=b.w+2,d=b.h+2;a.w>c&&(a.r={x:a.x+c,y:a.y,w:a.w-c,h:d},this.spaces.add(a.r)),a.h>d&&(a.d={x:a.x,y:a.y+d,w:a.w,h:a.h-d},this.spaces.add(a.d)),this.spaces.delete(a),a.o=b},TextureAtlasTree.prototype.getTextures=function(){for(var a=[this.root],b=[],c=1;c;){var d=a.pop();c--,d.o&&(b.push(d.o),d.r&&(a.push(d.r),c++),d.d&&(a.push(d.d),c++))}return b};var Component=function(a){this.id=Stage.componentId++,this.uComponent=a.adapter.getUComponentContext().createUComponentForComponent(this),this.stage=a,this.active=!1,this.attached=!1,this.parent=null,this.hasChildren=!1,this._clipping=!1,this._displayedTexture=null,this._renderWidth=0,this._renderHeight=0,this.hasBorders=!1,this.children=[],this._colorTopLeft=4294967295,this._colorTopRight=4294967295,this._colorBottomLeft=4294967295,this._colorBottomRight=4294967295,this.transitions=null,this.transitionSet=null,this.timedAnimationSet=null,this.tags=new ComponentTags(this),this._x=0,this._y=0,this._w=0,this._h=0,this._scaleX=1,this._scaleY=1,this._pivotX=.5,this._pivotY=.5,this._mountX=0,this._mountY=0,this._alpha=1,this._rotation=0,this._borderWidthTop=0,this._borderWidthBottom=0,this._borderWidthLeft=0,this._borderWidthRight=0,this._borderColorTop=4294967295,this._borderColorBottom=4294967295,this._borderColorLeft=4294967295,this._borderColorRight=4294967295,this._visible=!0,this.textRenderer=null,this._texture=null,this.displayedTexture=this._displayedTexture=null,this._src=null,this.clipping=!1,this._zIndex=0,this._forceZIndexContext=!1,this.notifyActivate=null,this.notifyDeactivate=null,this.rotationCache=0,this._sr=0,this._cr=1};Component.prototype.setAsRoot=function(){this.updateActiveFlag(),this.updateAttachedFlag(),this.uComponent.setAsRoot()},Component.prototype.setParent=function(a){this.parent!==a&&(this.parent&&(this.parent.hasChildren=this.parent.children.length>1,this.tags.unsetParent()),this.parent=a,a&&(this.uComponent.recalc=!0,a.hasChildren=!0,this.tags.setParent(a.tags)),this.updateActiveFlag(),this.updateAttachedFlag())},Component.prototype.add=function(a){if(a instanceof Component)return this.addChild(a),a;if(Utils.isArray(a)){for(var b=0,c=a.length;b<c;b++)this.add(a[b]);return null}if(Utils.isPlainObject(a)){var d=this.stage.c(a);return this.addChild(d),d}},Component.prototype.addChild=function(a){return a.parent===this&&this.children.indexOf(a)>=0?a:this.addChildAt(a,this.children.length)},Component.prototype.addChildren=function(a){var b,c=a.length;for(b=0;b<c;b++)this.addChild(a[b])},Component.prototype.setChildren=function(a){this.removeChildren(),this.addChildren(a)},Component.prototype.addChildAt=function(a,b){if(a===this)return a;if(b>=0&&b<=this.children.length){if(a.parent===this&&this.children.indexOf(a)===b);else{if(a.parent){a.parent.removeChild(a)}a.setParent(this),this.children.splice(b,0,a),this.uComponent.insertChild(b,a.uComponent)}return a}throw new Error(a+"addChildAt: The index "+b+" supplied is out of bounds "+this.children.length)},Component.prototype.getChildIndex=function(a){return this.children.indexOf(a)},Component.prototype.removeChild=function(a){var b=this.children.indexOf(a);if(b!==-1)return this.removeChildAt(b)},Component.prototype.removeChildAt=function(a){var b=this.children[a];return b.setParent(null),this.children.splice(a,1),this.uComponent.removeChild(a),b},Component.prototype.removeChildren=function(){var a=this.children.length;if(a){for(var b=0;b<a;b++){this.children[b].setParent(null)}this.children.splice(0,a),this.uComponent.clearChildren()}},Component.prototype.getDepth=function(){var a=0,b=this;do{a++,b=b.parent}while(b);return a},Component.prototype.getAncestor=function(a){for(var b=this;a>0&&b.parent;)b=b.parent,a--;return b},Component.prototype.getAncestorAtDepth=function(a){var b=this.getDepth()-a;return b<0?null:this.getAncestor(b)},Component.prototype.isAncestorOf=function(a){for(var b=a;b.parent;){if(this===b)return!0;b=b.parent}return!1},Component.prototype.getSharedAncestor=function(a){var b=this,c=a,d=b.getDepth(),e=c.getDepth();d>e?b=b.getAncestor(d-e):e>d&&(c=c.getAncestor(e-d));do{if(b===c)return b;b=b.parent,c=c.parent}while(b&&c);return null},Component.prototype.isActive=function(){return this._visible&&this._alpha>0&&(this.parent?this.parent.active:this.stage.root===this)},Component.prototype.isAttached=function(){return this.parent?this.parent.attached:this.stage.root===this},Component.prototype.updateActiveFlag=function(){var a=this.isActive();if(this.active!==a){if(a){0!=this.zIndex&&this.stage.zIndexUsage++;var b=null;this.texture&&this.texture.source.glTexture?(b=this.texture,this.texture.source.addComponent(this),this.texture.addComponent(this)):this.displayedTexture&&this.displayedTexture.source.glTexture&&(b=this.displayedTexture),this.displayedTexture=null,this.displayedTexture=b,this.active=a,this.texture&&(this.texture.source.addComponent(this),this.texture.addComponent(this)),this.displayedTexture&&this.displayedTexture!==this.texture&&(this.displayedTexture.source.addComponent(this),this.displayedTexture.addComponent(this))}else 0!=this.zIndex&&this.stage.zIndexUsage--,this.texture&&(this.texture.removeComponent(this),this.texture.source.removeComponent(this)),this.displayedTexture&&(this.displayedTexture.removeComponent(this),this.displayedTexture.source.removeComponent(this)),this.active=a;var c=this.children.length;if(c>0)for(var d=0;d<c;d++)this.children[d].updateActiveFlag();a?this.notifyActivate&&this.notifyActivate():this.notifyDeactivate&&this.notifyDeactivate()}},Component.prototype.updateAttachedFlag=function(){var a=this.isAttached();if(this.attached!==a){if(this.attached=a,a){var b=this;this.transitionSet&&this.transitionSet.forEach(function(a){a.isActive()&&b.stage.addActiveTransition(a)}),this.timedAnimationSet&&this.timedAnimationSet.forEach(function(a){a.isActive()&&b.stage.addActiveAnimation(a)})}var c=this.children.length;if(c>0)for(var d=0;d<c;d++)this.children[d].updateAttachedFlag()}},Component.prototype.addTimedAnimation=function(a){this.timedAnimationSet||(this.timedAnimationSet=new Set),this.timedAnimationSet.add(a)},Component.prototype.removeTimedAnimation=function(a){this.timedAnimationSet.delete(a)},Component.prototype.animation=function(a){var b=this.stage.animation(a);return b.subject=this,b},Component.prototype.a=function(a){return this.animation(a)},Component.prototype.transition=function(a,b){var c=Component.propAliases.get(a);if(b||null===b){if(c){for(var d=0,e=c.length;d<e;d++)this.setPropertyTransition(c[d],b);return this.getPropertyTransition(c[0])}return this.setPropertyTransition(a,b)}return this.getPropertyTransition(a,b)},Component.prototype.t=function(a,b){this.transition(a,b)},Component.prototype.transitions=function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=Component.propAliases.get(a[d]);f?c=c.concat(f):c.push(a[d])}if(b||null===b){var g=[];for(d=0,e=c.length;d<e;d++)g.push(this.setPropertyTransition(c[d],b));return g}var g=[];for(d=0,e=c.length;d<e;d++)g.push(this.getPropertyTransition(c[d],b));return g},Component.prototype.getRenderWidth=function(){return this.active?this._renderWidth:this._getRenderWidth()},Component.prototype._getRenderWidth=function(){return this._w?this._w:this.texture&&this.texture.source.glTexture?this.texture.w||this.texture.source.w*this.texture.source.iprecision:this.displayedTexture?this.displayedTexture.w||this.displayedTexture.source.w*this.displayedTexture.source.iprecision:0},Component.prototype.getRenderHeight=function(){return this.active?this._renderHeight:this._getRenderHeight()},Component.prototype._getRenderHeight=function(){return this._h?this._h:this.texture&&this.texture.source.glTexture?(this.texture.h||this.texture.source.h)*this.texture.source.iprecision:this.displayedTexture?(this.displayedTexture.h||this.displayedTexture.source.h)*this.displayedTexture.source.iprecision:0},Component.prototype.setPropertyTransition=function(a,b){var c=Component.getPropertyIndex(a);if(c==-1)throw new Error("Unknown transition property: "+a);return b?(this.transitions||(this.transitions=new Array(Component.nTransitions),this.transitionSet=new Set),this.transitions[c]||(this.transitions[c]=new PropertyTransition(this,a),this.transitionSet.add(this.transitions[c])),this.transitions[c].set(b)):this.transitions&&(this.transitions[c]&&this.transitionSet.delete(this.transitions[c]),this.transitions[c]=null),this.transitions[c]},Component.prototype.getPropertyTransition=function(a){var b=Component.getPropertyIndex(a);if(b==-1)throw new Error("Unknown transition property: "+a);return this.transitions&&this.transitions[b]?this.transitions[b]:null},Component.prototype.getCornerPoints=function(){return this.uComponent.getCornerPoints()},Component.prototype.fastForward=function(a){var b,c;if(Component.propAliases.has(a)){var d=Component.propAliases.get(a);for(c=d.length,b=0;b<c;b++)this.fastForward(d[b])}else{var e=Component.getPropertyIndex(a);if(e==-1)throw new Error("Unknown transition property: "+a);if(this.transitions&&this.transitions[e]){var f=this.transitions[e];f&&f.isActive()&&f.reset(f.targetValue,f.targetValue,1)}}},Component.prototype.getLocationString=function(){var a;if(this.parent&&(a=this.parent.children.indexOf(this))>=0){var b=this.getLocalTags();return this.parent.getLocationString()+":"+a+"["+this.id+"]"+(b.length?"("+b.join(",")+")":"")}return""},Component.prototype.getLocalTags=function(){return this.tags.getLocalTags()},Component.prototype.setTags=function(a){this.tags.setTags(a)},Component.prototype.addTag=function(a){this.tags.addTag(a)},Component.prototype.removeTag=function(a){this.tags.removeTag(a)},Component.prototype.hasTag=function(a){return this.tags.hasTag(a)},Component.prototype.tag=function(a){return this.tags.tag(a)},Component.prototype.mtag=function(a){return this.tags.mtag(a)},Component.prototype.stag=function(a,b){for(var c=this.mtag(a),d=c.length,e=0;e<d;e++)c[e].set(b)},Component.prototype.textureSourceIsLoaded=function(){this.displayedTexture=this.texture},Component.prototype.textureSourceIsAddedToTextureAtlas=function(){this._updateTextureCoords()},Component.prototype.textureSourceIsRemovedFromTextureAtlas=function(){this._updateTextureCoords()},Component.prototype.displayedTextureClippingChanged=function(){this._renderWidth=this._getRenderWidth(),this._renderHeight=this._getRenderHeight(),this._updateLocalDimensions(),this._updateTextureCoords()},Component.prototype.set=function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=a[b[c]];this.setSetting(b[c],d)}},Component.prototype.setSetting=function(a,b){var c=Component.propAliases.get(a);if(c)for(var d=0,e=c.length;d<e;d++)this.setSetting(c[d],b);else switch(a){case"tag":case"tags":this.setTags(b);break;case"children":var f=this.stage;if(!Utils.isArray(b))throw new TypeError("Children must be array.");for(var g=[],d=0,e=b.length;d<e;d++)b[d]instanceof Component?g[d]=b[d]:g[d]=f.c(b[d]);this.setChildren(g);break;case"transitions":if(!Utils.isObject(b))throw new TypeError("Transitions must be object.");for(var h in b)this.transition(h,b[h]);break;default:var i=Component.SETTINGS[a];i?i.s(this,b):(i=Component.FINAL_SETTINGS[a],i?i.sf(this,b):console.warn("Unknown component property: "+a))}},Component.prototype.toString=function(){var a=this.getSettingsObject();return Component.getPrettyJsonified(a,"")},Component.getPrettyJsonified=function(a,b){var c=a.children;delete a.children;var d=["color","colorTopLeft","colorTopRight","colorBottomLeft","colorBottomRight","borderColor","borderColorTop","borderColorBottom","borderColorLeft","borderColorRight"],e=JSON.stringify(a,function(a,b){return d.indexOf(a)!==-1?"COLOR["+b.toString(16)+"]":b});if(e=e.replace(/"COLOR\[([a-f0-9]{1,8})\]"/g,"0x$1"),c&&c.length){var f="{}"===e;e=e.substr(0,e.length-1)+(f?"":",")+'"children":[\n';for(var g=c.length,h=0;h<g;h++)e+=Component.getPrettyJsonified(c[h],b+"  ")+(h<g-1?",":"")+"\n";e+=b+"]}"}return b+e},Component.prototype.getSettingsObject=function(){var a=this.getNonDefaults();return this.hasChildren&&(a.children=this.children.map(function(a){return a.getSettingsObject()})),a},Component.prototype.getNonDefaults=function(){var a={};if(this.tags&&this.tags.size&&(a.tags=this.getLocalTags()),0!==this.x&&(a.x=this.x),0!==this.y&&(a.y=this.y),0!==this.w&&(a.w=this.w),0!==this.h&&(a.h=this.h),1!==this.alpha&&(a.alpha=this.alpha),0!==this.rotation&&(a.rotation=this.rotation),this.visible!==!0&&(a.visible=this.visible),this.clipping!==!1&&(a.clipping=this.clipping),this.zIndex&&(a.zIndex=this.zIndex),this.forceZIndexContext!==!1&&(a.forceZIndexContext=this.forceZIndexContext),this.textRenderer&&(a.text=this.textRenderer.settings.getNonDefaults()),this.src&&(a.src=this.src),this.rect&&(a.rect=!0),1!==this.scaleX&&this.scaleX===this.scaleY?a.scale=this.scaleX:(1!==this.scaleX&&(a.scaleX=this.scaleX),1!==this.scaleY&&(a.scaleY=this.scaleY)),.5!==this.pivotX&&(a.pivotX=this.pivotX),.5!==this.pivotY&&(a.pivotY=this.pivotY),0!==this.mountX&&(a.mountX=this.mountX),0!==this.mountY&&(a.mountY=this.mountY),0!==this.borderWidthTop&&this.borderWidthTop===this.borderWidthBottom&&this.borderWidthTop===this.borderWidthLeft&&this.borderWidthTop===this.borderWidthRight?a.borderWidth=this.borderWidthTop:(0!==this.borderWidthTop&&(a.borderWidthTop=this.borderWidthTop),0!==this.borderWidthBottom&&(a.borderWidthBottom=this.borderWidthBottom),0!==this.borderWidthLeft&&(a.borderWidthLeft=this.borderWidthLeft),0!==this.borderWidthRight&&(a.borderWidthRight=this.borderWidthRight)),4294967295!==this.borderColorTop&&this.borderColorTop===this.borderColorBottom&&this.borderColorTop===this.borderColorLeft&&this.borderColorTop===this.borderColorRight?a.borderColor=this.borderColorTop:(4294967295!==this.borderColorTop&&(a.borderColorTop=this.borderColorTop),4294967295!==this.borderColorBottom&&(a.borderColorBottom=this.borderColorBottom),4294967295!==this.borderColorLeft&&(a.borderColorLeft=this.borderColorLeft),4294967295!==this.borderColorRight&&(a.borderColorRight=this.borderColorRight)),4294967295!==this.colorTopLeft&&this.colorTopLeft===this.colorTopRight&&this.colorTopLeft===this.colorBottomLeft&&this.colorTopLeft===this.colorBottomRight?a.color=this.colorTopLeft:(4294967295!==this.colorTopLeft&&(a.colorTopLeft=this.colorTopLeft),4294967295!==this.colorTopRight&&(a.colorTopRight=this.colorTopRight),4294967295!==this.colorBottomLeft&&(a.colorBottomLeft=this.colorBottomLeft),4294967295!==this.colorBottomRight&&(a.colorBottomRight=this.colorBottomRight)),this.texture){var b=this.texture.getNonDefaults();Object.keys(b).length&&(a.texture=b)}return a},Component.prototype.hasEqualColors=function(){return this._colorTopLeft===this._colorTopRight&&this._colorTopLeft===this._colorBottomRight&&this._colorTopLeft===this._colorBottomLeft},Component.propAliases=new Map,Component.propAliases.set("scale",["scaleX","scaleY"]),Component.propAliases.set("borderWidth",["borderWidthTop","borderWidthBottom","borderWidthLeft","borderWidthRight"]),Component.propAliases.set("borderColor",["borderColorTop","borderColorBottom","borderColorLeft","borderColorRight"]),Component.propAliases.set("color",["colorTopLeft","colorTopRight","colorBottomLeft","colorBottomRight"]),Component.propAliases.set("colorTop",["colorTopLeft","colorTopRight"]),Component.propAliases.set("colorBottom",["colorBottomLeft","colorBottomRight"]),Component.propAliases.set("colorLeft",["colorTopLeft","colorBottomLeft"]),Component.propAliases.set("colorRight",["colorTopRight","colorBottomRight"]),Object.defineProperty(Component.prototype,"renderWidth",{get:function(){return this.getRenderWidth()}}),Object.defineProperty(Component.prototype,"renderHeight",{get:function(){return this.getRenderHeight()}}),Object.defineProperty(Component.prototype,"x",{get:function(){return this.transitions&&this.transitions[0]?this.transitions[0].targetValue:this.X},set:function(a){this.transitions&&this.transitions[0]?this.setTransitionTargetValue(this.transitions[0],a,this.X):this.X=a}}),Object.defineProperty(Component.prototype,"X",{get:function(){return this._x},set:function(a){var b=this._x;b!==a&&(this._x=a,this._updateLocalTranslateDelta(a-b,0))}}),Object.defineProperty(Component.prototype,"y",{get:function(){return this.transitions&&this.transitions[1]?this.transitions[1].targetValue:this.Y},set:function(a){this.transitions&&this.transitions[1]?this.setTransitionTargetValue(this.transitions[1],a,this.Y):this.Y=a}}),Object.defineProperty(Component.prototype,"Y",{get:function(){return this._y},set:function(a){var b=this._y;b!==a&&(this._y=a,this._updateLocalTranslateDelta(0,a-b))}}),Object.defineProperty(Component.prototype,"w",{get:function(){return this.transitions&&this.transitions[2]?this.transitions[2].targetValue:this.W},set:function(a){this.transitions&&this.transitions[2]?this.setTransitionTargetValue(this.transitions[2],a,this.W):this.W=a}}),Object.defineProperty(Component.prototype,"W",{get:function(){return this._w},set:function(a){this._w!==a&&(this._w=a,this._renderWidth=this._getRenderWidth(),this._updateLocalDimensions())}}),Object.defineProperty(Component.prototype,"h",{get:function(){return this.transitions&&this.transitions[3]?this.transitions[3].targetValue:this.H},set:function(a){this.transitions&&this.transitions[3]?this.setTransitionTargetValue(this.transitions[3],a,this.H):this.H=a}}),Object.defineProperty(Component.prototype,"H",{get:function(){return this._h},set:function(a){this._h!==a&&(this._h=a,this._renderHeight=this._getRenderHeight(),this._updateLocalDimensions())}}),Object.defineProperty(Component.prototype,"scaleX",{get:function(){return this.transitions&&this.transitions[4]?this.transitions[4].targetValue:this.SCALEX},set:function(a){this.transitions&&this.transitions[4]?this.setTransitionTargetValue(this.transitions[4],a,this.SCALEX):this.SCALEX=a}}),Object.defineProperty(Component.prototype,"SCALEX",{get:function(){return this._scaleX},set:function(a){this._scaleX!==a&&(this._scaleX=a,this._updateLocalTransform())}}),Object.defineProperty(Component.prototype,"scaleY",{get:function(){return this.transitions&&this.transitions[5]?this.transitions[5].targetValue:this.SCALEY},set:function(a){this.transitions&&this.transitions[5]?this.setTransitionTargetValue(this.transitions[5],a,this.SCALEY):this.SCALEY=a}}),Object.defineProperty(Component.prototype,"SCALEY",{get:function(){return this._scaleY},set:function(a){this._scaleY!==a&&(this._scaleY=a,this._updateLocalTransform())}}),Object.defineProperty(Component.prototype,"pivotX",{get:function(){return this.transitions&&this.transitions[6]?this.transitions.get("pivotX").targetValue:this.PIVOTX},set:function(a){this.transitions&&this.transitions[6]?this.setTransitionTargetValue(this.transitions[6],a,this.PIVOTX):this.PIVOTX=a}}),Object.defineProperty(Component.prototype,"PIVOTX",{get:function(){return this._pivotX},set:function(a){this._pivotX!==a&&(this._pivotX=a,this._updateLocalTranslate())}}),Object.defineProperty(Component.prototype,"pivotY",{get:function(){return this.transitions&&this.transitions[7]?this.transitions[7].targetValue:this.PIVOTY},set:function(a){this.transitions&&this.transitions[7]?this.setTransitionTargetValue(this.transitions[7],a,this.PIVOTY):this.PIVOTY=a}}),Object.defineProperty(Component.prototype,"PIVOTY",{get:function(){return this._pivotY},set:function(a){this._pivotY!==a&&(this._pivotY=a,this._updateLocalTranslate())}}),Object.defineProperty(Component.prototype,"mountX",{get:function(){return this.transitions&&this.transitions[8]?this.transitions[8].targetValue:this.MOUNTX},set:function(a){this.transitions&&this.transitions[8]?this.setTransitionTargetValue(this.transitions[8],a,this.MOUNTX):this.MOUNTX=a}}),Object.defineProperty(Component.prototype,"MOUNTX",{get:function(){return this._mountX},set:function(a){this._mountX!==a&&(this._mountX=a,this._updateLocalTranslate())}}),Object.defineProperty(Component.prototype,"mountY",{get:function(){return this.transitions&&this.transitions[9]?this.transitions[9].targetValue:this.MOUNTY},set:function(a){this.transitions&&this.transitions[9]?this.setTransitionTargetValue(this.transitions[9],a,this.MOUNTY):this.MOUNTY=a}}),Object.defineProperty(Component.prototype,"MOUNTY",{get:function(){return this._mountY},set:function(a){this._mountY!==a&&(this._mountY=a,this._updateLocalTranslate())}}),Object.defineProperty(Component.prototype,"alpha",{get:function(){return this.transitions&&this.transitions[10]?this.transitions[10].targetValue:this.ALPHA},set:function(a){this.transitions&&this.transitions[10]?this.setTransitionTargetValue(this.transitions[10],a,this.ALPHA):this.ALPHA=a}}),Object.defineProperty(Component.prototype,"ALPHA",{get:function(){return this._alpha},set:function(a){a>1?a=1:a<0&&(a=0);var b=this._alpha;b!==a&&(this._alpha=a,this._updateLocalAlpha(),0===b!=(0===a)&&this.updateActiveFlag())}}),Object.defineProperty(Component.prototype,"rotation",{get:function(){return this.transitions&&this.transitions[11]?this.transitions[11].targetValue:this.ROTATION},set:function(a){this.transitions&&this.transitions[11]?this.setTransitionTargetValue(this.transitions[11],a,this.ROTATION):this.ROTATION=a}}),Object.defineProperty(Component.prototype,"ROTATION",{get:function(){return this._rotation},set:function(a){this._rotation!==a&&(this._rotation=a,this._updateLocalTransform())}}),Object.defineProperty(Component.prototype,"borderWidthTop",{get:function(){return this.transitions&&this.transitions[12]?this.transitions[12].targetValue:this.BORDERWIDTHTOP},set:function(a){this.transitions&&this.transitions[12]?this.setTransitionTargetValue(this.transitions[12],a,this.BORDERWIDTHTOP):this.BORDERWIDTHTOP=a}}),Object.defineProperty(Component.prototype,"BORDERWIDTHTOP",{get:function(){return this._borderWidthTop},set:function(a){var b=this._borderWidthTop;b!==a&&(this._borderWidthTop=a,0===b!=(0===a)&&(this.hasBorders=this._borderWidthTop||this._borderWidthBottom||this._borderWidthLeft||this._borderWidthRight),this.uComponent.setBorderTop(this._borderWidthTop,this._borderColorTop))}}),Object.defineProperty(Component.prototype,"borderWidthBottom",{get:function(){return this.transitions&&this.transitions[13]?this.transitions[13].targetValue:this.BORDERWIDTHBOTTOM},set:function(a){this.transitions&&this.transitions[13]?this.setTransitionTargetValue(this.transitions[13],a,this.BORDERWIDTHBOTTOM):this.BORDERWIDTHBOTTOM=a}}),Object.defineProperty(Component.prototype,"BORDERWIDTHBOTTOM",{get:function(){return this._borderWidthBottom},set:function(a){var b=this._borderWidthBottom;b!==a&&(this._borderWidthBottom=a,0===b!=(0===a)&&(this.hasBorders=this._borderWidthBottom||this._borderWidthBottom||this._borderWidthLeft||this._borderWidthRight),this.uComponent.setBorderBottom(this._borderWidthBottom,this._borderColorBottom))}}),Object.defineProperty(Component.prototype,"borderWidthLeft",{get:function(){return this.transitions&&this.transitions[14]?this.transitions[14].targetValue:this.BORDERWIDTHLEFT},set:function(a){this.transitions&&this.transitions[14]?this.setTransitionTargetValue(this.transitions[14],a,this.BORDERWIDTHLEFT):this.BORDERWIDTHLEFT=a}}),Object.defineProperty(Component.prototype,"BORDERWIDTHLEFT",{get:function(){return this._borderWidthLeft},set:function(a){var b=this._borderWidthLeft;b!==a&&(this._borderWidthLeft=a,0===b!=(0===a)&&(this.hasBorders=this._borderWidthLeft||this._borderWidthBottom||this._borderWidthLeft||this._borderWidthRight),this.uComponent.setBorderLeft(this._borderWidthLeft,this._borderColorLeft))}}),Object.defineProperty(Component.prototype,"borderWidthRight",{get:function(){return this.transitions&&this.transitions[15]?this.transitions[15].targetValue:this.BORDERWIDTHRIGHT},
set:function(a){this.transitions&&this.transitions[15]?this.setTransitionTargetValue(this.transitions[15],a,this.BORDERWIDTHRIGHT):this.BORDERWIDTHRIGHT=a}}),Object.defineProperty(Component.prototype,"BORDERWIDTHRIGHT",{get:function(){return this._borderWidthRight},set:function(a){var b=this._borderWidthRight;b!==a&&(this._borderWidthRight=a,0===b!=(0===a)&&(this.hasBorders=this._borderWidthRight||this._borderWidthBottom||this._borderWidthRight||this._borderWidthRight),this.uComponent.setBorderRight(this._borderWidthRight,this._borderColorRight))}}),Object.defineProperty(Component.prototype,"borderColorTop",{get:function(){return this.transitions&&this.transitions[16]?this.transitions[16].targetValue:this.BORDERCOLORTOP},set:function(a){this.transitions&&this.transitions[16]?this.setTransitionTargetValue(this.transitions[16],a,this.BORDERCOLORTOP):this.BORDERCOLORTOP=a}}),Object.defineProperty(Component.prototype,"BORDERCOLORTOP",{get:function(){return this._borderColorTop},set:function(a){this._borderColorTop!==a&&(this._borderColorTop=a,this.uComponent.setBorderTop(this._borderWidthTop,this._borderColorTop))}}),Object.defineProperty(Component.prototype,"borderColorBottom",{get:function(){return this.transitions&&this.transitions[17]?this.transitions[17].targetValue:this.BORDERCOLORBOTTOM},set:function(a){this.transitions&&this.transitions[17]?this.setTransitionTargetValue(this.transitions[17],a,this.BORDERCOLORBOTTOM):this.BORDERCOLORBOTTOM=a}}),Object.defineProperty(Component.prototype,"BORDERCOLORBOTTOM",{get:function(){return this._borderColorBottom},set:function(a){this._borderColorBottom!==a&&(this._borderColorBottom=a,this.uComponent.setBorderBottom(this._borderWidthBottom,this._borderColorBottom))}}),Object.defineProperty(Component.prototype,"borderColorLeft",{get:function(){return this.transitions&&this.transitions[18]?this.transitions[18].targetValue:this.BORDERCOLORLEFT},set:function(a){this.transitions&&this.transitions[18]?this.setTransitionTargetValue(this.transitions[18],a,this.BORDERCOLORLEFT):this.BORDERCOLORLEFT=a}}),Object.defineProperty(Component.prototype,"BORDERCOLORLEFT",{get:function(){return this._borderColorLeft},set:function(a){this._borderColorLeft!==a&&(this._borderColorLeft=a,this.uComponent.setBorderLeft(this._borderWidthLeft,this._borderColorLeft))}}),Object.defineProperty(Component.prototype,"borderColorRight",{get:function(){return this.transitions&&this.transitions[19]?this.transitions[19].targetValue:this.BORDERCOLORRIGHT},set:function(a){this.transitions&&this.transitions[19]?this.setTransitionTargetValue(this.transitions[19],a,this.BORDERCOLORRIGHT):this.BORDERCOLORRIGHT=a}}),Object.defineProperty(Component.prototype,"BORDERCOLORRIGHT",{get:function(){return this._borderColorRight},set:function(a){this._borderColorRight!==a&&(this._borderColorRight=a,this.uComponent.setBorderRight(this._borderWidthRight,this._borderColorRight))}}),Object.defineProperty(Component.prototype,"colorTopLeft",{get:function(){return this.transitions&&this.transitions[20]?this.transitions[20].targetValue:this.COLORTOPLEFT},set:function(a){this.transitions&&this.transitions[20]?this.setTransitionTargetValue(this.transitions[20],a,this.COLORTOPLEFT):this.COLORTOPLEFT=a}}),Object.defineProperty(Component.prototype,"COLORTOPLEFT",{get:function(){return this._colorTopLeft},set:function(a){this._colorTopLeft!==a&&(this._colorTopLeft=a,this.uComponent.setColorUl(a))}}),Object.defineProperty(Component.prototype,"colorTopRight",{get:function(){return this.transitions&&this.transitions[21]?this.transitions[21].targetValue:this.COLORTOPRIGHT},set:function(a){this.transitions&&this.transitions[21]?this.setTransitionTargetValue(this.transitions[21],a,this.COLORTOPRIGHT):this.COLORTOPRIGHT=a}}),Object.defineProperty(Component.prototype,"COLORTOPRIGHT",{get:function(){return this._colorTopRight},set:function(a){this._colorTopRight!==a&&(this._colorTopRight=a,this.uComponent.setColorUr(a))}}),Object.defineProperty(Component.prototype,"colorBottomLeft",{get:function(){return this.transitions&&this.transitions[22]?this.transitions[22].targetValue:this.COLORBOTTOMLEFT},set:function(a){this.transitions&&this.transitions[22]?this.setTransitionTargetValue(this.transitions[22],a,this.COLORBOTTOMLEFT):this.COLORBOTTOMLEFT=a}}),Object.defineProperty(Component.prototype,"COLORBOTTOMLEFT",{get:function(){return this._colorBottomLeft},set:function(a){this._colorBottomLeft!==a&&(this._colorBottomLeft=a,this.uComponent.setColorBl(a))}}),Object.defineProperty(Component.prototype,"colorBottomRight",{get:function(){return this.transitions&&this.transitions[23]?this.transitions[23].targetValue:this.COLORBOTTOMRIGHT},set:function(a){this.transitions&&this.transitions[23]?this.setTransitionTargetValue(this.transitions[23],a,this.COLORBOTTOMRIGHT):this.COLORBOTTOMRIGHT=a}}),Object.defineProperty(Component.prototype,"COLORBOTTOMRIGHT",{get:function(){return this._colorBottomRight},set:function(a){this._colorBottomRight!==a&&(this._colorBottomRight=a,this.uComponent.setColorBr(a))}}),Object.defineProperty(Component.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible!==a&&(this._visible=a,this._updateLocalAlpha(),this.updateActiveFlag())}}),Object.defineProperty(Component.prototype,"clipping",{get:function(){return this._clipping},set:function(a){this._clipping!==a&&(this._clipping=a,this.uComponent.setClipping(a))}}),Object.defineProperty(Component.prototype,"zIndex",{get:function(){return this._zIndex},set:function(a){var b=this._zIndex;b!==a&&(this._zIndex=a,this.active&&(0!==b&&0===a?this.stage.zIndexUsage--:0===b&&0!==a&&this.stage.zIndexUsage++),this.uComponent.setZIndex(this.zIndex))}}),Object.defineProperty(Component.prototype,"forceZIndexContext",{get:function(){return this._forceZIndexContext},set:function(a){this._forceZIndexContext!==a&&(this._forceZIndexContext=a,this.uComponent.setForceZIndexContext(this.forceZIndexContext))}}),Object.defineProperty(Component.prototype,"scale",{get:function(){return this.scaleX},set:function(a){this.scaleX=a,this.scaleY=a}}),Object.defineProperty(Component.prototype,"borderWidth",{get:function(){return this.borderWidthTop},set:function(a){this.borderWidthTop=a,this.borderWidthBottom=a,this.borderWidthLeft=a,this.borderWidthRight=a}}),Object.defineProperty(Component.prototype,"borderColor",{get:function(){return this.borderColorTop},set:function(a){this.borderColorTop=a,this.borderColorBottom=a,this.borderColorLeft=a,this.borderColorRight=a}}),Object.defineProperty(Component.prototype,"texture",{get:function(){return this._texture},set:function(a){if(null===a||a instanceof Texture){var b=this._texture;if(a!==b){if(null!==a&&!(a instanceof Texture))throw new Error("incorrect value for texture");this._texture=a,this.active&&b&&this.displayedTexture!==b&&(b.removeComponent(this),a&&b.source===a.source||this.displayedTexture&&this.displayedTexture.source===b.source||b.source.removeComponent(this)),a?(this.active&&(a.source.addComponent(this),a.addComponent(this)),a.source.glTexture&&(this.displayedTexture=a)):this.displayedTexture=null}}else Utils.isPlainObject(a)&&this._texture&&this._texture.set(a)}}),Object.defineProperty(Component.prototype,"displayedTexture",{get:function(){return this._displayedTexture},set:function(a){if(null===a||a instanceof Texture){var b=this._displayedTexture;if(a!==b){this.active&&b&&(b!==this.texture&&b.removeComponent(this),a&&b.source===a.source||b.source.removeComponent(this));var c=this._renderWidth,d=this._renderHeight;this._displayedTexture=a,this._renderWidth=this._getRenderWidth(),this._renderHeight=this._getRenderHeight(),b&&c==this._renderWidth&&d==this._renderHeight||this._updateLocalDimensions(),a?(this._updateTextureCoords(),this.stage.uComponentContext.setDisplayedTextureSource(this.uComponent,a.source)):this.stage.uComponentContext.setDisplayedTextureSource(this.uComponent,null)}}else Utils.isPlainObject(a)&&this._displayedTexture&&this._displayedTexture.set(a)}}),Object.defineProperty(Component.prototype,"color",{get:function(){return this.colorTopLeft},set:function(a){this.colorTopLeft=a,this.colorTopRight=a,this.colorBottomLeft=a,this.colorBottomRight=a}}),Object.defineProperty(Component.prototype,"colorTop",{get:function(){return this.colorTopLeft},set:function(a){this.colorTopLeft=a,this.colorTopRight=a}}),Object.defineProperty(Component.prototype,"colorBottom",{get:function(){return this.colorBottomLeft},set:function(a){this.colorBottomLeft=a,this.colorBottomRight=a}}),Object.defineProperty(Component.prototype,"colorLeft",{get:function(){return this.colorTopLeft},set:function(a){this.colorTopLeft=a,this.colorBottomLeft=a}}),Object.defineProperty(Component.prototype,"colorRight",{get:function(){return this.colorTopRight},set:function(a){this.colorTopRight=a,this.colorBottomRight=a}}),Object.defineProperty(Component.prototype,"src",{get:function(){return this._src},set:function(a){var b=this._src;if(!b||b.src!==a||!this.texture||!this.texture.source.renderInfo||this.texture.source.renderInfo.src!==a){if(!a)return b&&(this.texture=null),void(this._src=null);Utils.isString(a)&&(a={src:a}),this.texture=this.stage.textureManager.getTexture(a.src,a),this._src=a}}}),Object.defineProperty(Component.prototype,"text",{get:function(){return this.textRenderer||(this.textRenderer=new ComponentText(this)),this.textRenderer},set:function(a){null===a?this.textRenderer&&(this.textRenderer=null,this.texture=null):(this.textRenderer||(this.textRenderer=new ComponentText(this)),Utils.isString(a)?this.textRenderer.text=a:this.textRenderer.set(a))}}),Object.defineProperty(Component.prototype,"rect",{get:function(){return this.texture===this.stage.getRectangleTexture()},set:function(a){this.texture=a?this.stage.getRectangleTexture():null}}),Component.prototype.setTransitionTargetValue=function(a,b,c){a.targetValue!==b&&a.updateTargetValue(b,c)},Component.prototype._updateLocalTransform=function(){0!==this._rotation&&this._rotation%(2*Math.PI)?(this._rotation!==this.rotationCache&&(this.rotationCache=this._rotation,this._sr=Math.sin(this._rotation),this._cr=Math.cos(this._rotation)),this.uComponent.setLocalTransform(this._cr*this._scaleX,-this._sr*this._scaleY,this._sr*this._scaleX,this._cr*this._scaleY)):this.uComponent.setLocalTransform(this._scaleX,0,0,this._scaleY),this._updateLocalTranslate()},Component.prototype._updateLocalTranslate=function(){var a=this._pivotX*this._renderWidth,b=this._pivotY*this._renderHeight,c=this._x-(a*this.uComponent.getLocalTa()+b*this.uComponent.getLocalTb())+a,d=this._y-(a*this.uComponent.getLocalTc()+b*this.uComponent.getLocalTd())+b;c-=this._mountX*this._renderWidth,d-=this._mountY*this._renderHeight,this.uComponent.setLocalTranslate(c,d)},Component.prototype._updateLocalTranslateDelta=function(a,b){this.uComponent.addLocalTranslate(a,b)},Component.prototype._updateLocalAlpha=function(){this.uComponent.setLocalAlpha(this._visible?this._alpha:0)},Component.prototype._updateLocalDimensions=function(){this.uComponent.setDimensions(this._renderWidth,this._renderHeight),this._updateLocalTranslate()},Component.prototype._updateTextureCoords=function(){if(this.displayedTexture&&this.displayedTexture.source){var a=this.displayedTexture,b=this.displayedTexture.source,c=0,d=0,e=1,f=1;if(a.clipping){var g,h,i,j=b.getRenderWidth(),k=b.getRenderHeight();iw=1/j,g=1/k,h=a.w?a.w*iw:(j-a.x)*iw,i=a.h?a.h*g:(k-a.y)*g,iw*=a.x,g*=a.y,c=Math.min(1,Math.max(0,iw)),d=Math.min(1,Math.max(g)),e=Math.min(1,Math.max(e*h+iw)),f=Math.min(1,Math.max(f*i+g))}if(b.inTextureAtlas){var l=488281e-9*b.textureAtlasX,m=488281e-9*b.textureAtlasY,n=488281e-9*b.w,o=488281e-9*b.h;c=l,d=m,e=e*n+l,f=f*o+m}this.uComponent.setTextureCoords(c,d,e,f),this.uComponent.setInTextureAtlas(b.inTextureAtlas)}},Component.getPropertyIndex=function(a){return Component.SETTINGS[a].i},Component.getPropertyIndexFinal=function(a){return Component.FINAL_SETTINGS[a].i},Component.SETTINGS={x:{i:0,s:function(a,b){a.x=b},g:function(a){return a.x},sf:function(a,b){a.X=b},gf:function(a){return a.X},m:StageUtils.mergeNumbers},y:{i:1,s:function(a,b){a.y=b},g:function(a){return a.y},sf:function(a,b){a.Y=b},gf:function(a){return a.Y},m:StageUtils.mergeNumbers},w:{i:2,s:function(a,b){a.w=b},g:function(a){return a.w},sf:function(a,b){a.W=b},gf:function(a){return a.W},m:StageUtils.mergeNumbers},h:{i:3,s:function(a,b){a.h=b},g:function(a){return a.h},sf:function(a,b){a.H=b},gf:function(a){return a.H},m:StageUtils.mergeNumbers},scaleX:{i:4,s:function(a,b){a.scaleX=b},g:function(a){return a.scaleX},sf:function(a,b){a.SCALEX=b},gf:function(a){return a.SCALEX},m:StageUtils.mergeNumbers},scaleY:{i:5,s:function(a,b){a.scaleY=b},g:function(a){return a.scaleY},sf:function(a,b){a.SCALEY=b},gf:function(a){return a.SCALEY},m:StageUtils.mergeNumbers},pivotX:{i:6,s:function(a,b){a.pivotX=b},g:function(a){return a.pivotX},sf:function(a,b){a.PIVOTX=b},gf:function(a){return a.PIVOTX},m:StageUtils.mergeNumbers},pivotY:{i:7,s:function(a,b){a.pivotY=b},g:function(a){return a.pivotY},sf:function(a,b){a.PIVOTY=b},gf:function(a){return a.PIVOTY},m:StageUtils.mergeNumbers},mountX:{i:8,s:function(a,b){a.mountX=b},g:function(a){return a.mountX},sf:function(a,b){a.MOUNTX=b},gf:function(a){return a.MOUNTX},m:StageUtils.mergeNumbers},mountY:{i:9,s:function(a,b){a.mountY=b},g:function(a){return a.mountY},sf:function(a,b){a.MOUNTY=b},gf:function(a){return a.MOUNTY},m:StageUtils.mergeNumbers},alpha:{i:10,s:function(a,b){a.alpha=b},g:function(a){return a.alpha},sf:function(a,b){a.ALPHA=b},gf:function(a){return a.ALPHA},m:StageUtils.mergeNumbers},rotation:{i:11,s:function(a,b){a.rotation=b},g:function(a){return a.rotation},sf:function(a,b){a.ROTATION=b},gf:function(a){return a.ROTATION},m:StageUtils.mergeNumbers},borderWidthTop:{i:12,s:function(a,b){a.borderWidthTop=b},g:function(a){return a.borderWidthTop},sf:function(a,b){a.BORDERWIDTHTOP=b},gf:function(a){return a.BORDERWIDTHTOP},m:StageUtils.mergeNumbers},borderWidthBottom:{i:13,s:function(a,b){a.borderWidthBottom=b},g:function(a){return a.borderWidthBottom},sf:function(a,b){a.BORDERWIDTHBOTTOM=b},gf:function(a){return a.BORDERWIDTHBOTTOM},m:StageUtils.mergeNumbers},borderWidthLeft:{i:14,s:function(a,b){a.borderWidthLeft=b},g:function(a){return a.borderWidthLeft},sf:function(a,b){a.BORDERWIDTHLEFT=b},gf:function(a){return a.BORDERWIDTHLEFT},m:StageUtils.mergeNumbers},borderWidthRight:{i:15,s:function(a,b){a.borderWidthRight=b},g:function(a){return a.borderWidthRight},sf:function(a,b){a.BORDERWIDTHRIGHT=b},gf:function(a){return a.BORDERWIDTHRIGHT},m:StageUtils.mergeNumbers},borderColorTop:{i:16,s:function(a,b){a.borderColorTop=b},g:function(a){return a.borderColorTop},sf:function(a,b){a.BORDERCOLORTOP=b},gf:function(a){return a.BORDERCOLORTOP},m:StageUtils.mergeColors},borderColorBottom:{i:17,s:function(a,b){a.borderColorBottom=b},g:function(a){return a.borderColorBottom},sf:function(a,b){a.BORDERCOLORBOTTOM=b},gf:function(a){return a.BORDERCOLORBOTTOM},m:StageUtils.mergeColors},borderColorLeft:{i:18,s:function(a,b){a.borderColorLeft=b},g:function(a){return a.borderColorLeft},sf:function(a,b){a.BORDERCOLORLEFT=b},gf:function(a){return a.BORDERCOLORLEFT},m:StageUtils.mergeColors},borderColorRight:{i:19,s:function(a,b){a.borderColorRight=b},g:function(a){return a.borderColorRight},sf:function(a,b){a.BORDERCOLORRIGHT=b},gf:function(a){return a.BORDERCOLORRIGHT},m:StageUtils.mergeColors},colorTopLeft:{i:20,s:function(a,b){a.colorTopLeft=b},g:function(a){return a.colorTopLeft},sf:function(a,b){a.COLORTOPLEFT=b},gf:function(a){return a.COLORTOPLEFT},m:StageUtils.mergeColors},colorTopRight:{i:21,s:function(a,b){a.colorTopRight=b},g:function(a){return a.colorTopRight},sf:function(a,b){a.COLORTOPRIGHT=b},gf:function(a){return a.COLORTOPRIGHT},m:StageUtils.mergeColors},colorBottomLeft:{i:22,s:function(a,b){a.colorBottomLeft=b},g:function(a){return a.colorBottomLeft},sf:function(a,b){a.COLORBOTTOMLEFT=b},gf:function(a){return a.COLORBOTTOMLEFT},m:StageUtils.mergeColors},colorBottomRight:{i:23,s:function(a,b){a.colorBottomRight=b},g:function(a){return a.colorBottomRight},sf:function(a,b){a.COLORBOTTOMRIGHT=b},gf:function(a){return a.COLORBOTTOMRIGHT},m:StageUtils.mergeColors},visible:{s:function(a,b){a.visible=b},g:function(a){return a.visible},sf:function(a,b){a.VISIBLE=b},gf:function(a){return a.VISIBLE},m:null},zIndex:{s:function(a,b){a.zIndex=b},g:function(a){return a.zIndex},sf:function(a,b){a.VISIBLE=b},gf:function(a){return a.VISIBLE},m:null},forceZIndexContext:{s:function(a,b){a.forceZIndexContext=b},g:function(a){return a.forceZIndexContext},sf:function(a,b){a.FORCEZINDEXCONTEXT=b},gf:function(a){return a.FORCEZINDEXCONTEXT},m:null},clipping:{s:function(a,b){a.clipping=b},g:function(a){return a.clipping},sf:function(a,b){a.CLIPPING=b},gf:function(a){return a.CLIPPING},m:null},rect:{s:function(a,b){a.rect=b},g:function(a){return a.rect},m:null},src:{s:function(a,b){a.src=b},g:function(a){return a.src},m:null},text:{s:function(a,b){a.text=b},g:function(a){return a.text},m:null},texture:{s:function(a,b){a.texture=b},g:function(a){return a.src},m:null}},Component.FINAL_SETTINGS={};for(var key in Component.SETTINGS)Component.SETTINGS.hasOwnProperty(key)&&(Component.FINAL_SETTINGS[key.toUpperCase()]=Component.SETTINGS[key]);Component.nTransitions=24;var ComponentTags=function(a){this.component=a,this.parent=null,this.tags=null,this.treeTags=null,this.cache=null,this.tagToComplex=null};ComponentTags.prototype.clearCache=function(a){if(this.cache&&(this.cache.delete(a),this.tagToComplex)){var b=this.tagToComplex.get(a);if(b){for(var c=0,d=b.length;c<d;c++)this.cache.delete(b[c]);this.tagToComplex.delete(a)}}},ComponentTags.prototype.unsetParent=function(){var a=null,b=0;if(this.treeTags&&(a=Utils.iteratorToArray(this.treeTags.keys()),(b=a.length)>0))for(var c=0;c<b;c++)for(var d=this.treeTags.get(a[c]),e=this;e=e.parent;){var f=e.treeTags.get(a[c]);d.forEach(function(a){f.delete(a)}),e.clearCache(a[c])}},ComponentTags.prototype.setParent=function(a){this.parent=a;var b=null,c=0;if(this.treeTags&&(b=Utils.iteratorToArray(this.treeTags.keys()),(c=b.length)>0))for(var d=0;d<c;d++)for(var e=this.treeTags.get(b[d]),f=this;f=f.parent;){f.treeTags||(f.treeTags=new Map);var g=f.treeTags.get(b[d]);g||(g=new Set,f.treeTags.set(b[d],g)),e.forEach(function(a){g.add(a)}),f.clearCache(b[d])}},ComponentTags.prototype.getLocalTags=function(){return this.tags},ComponentTags.prototype.setTags=function(a){Utils.isArray(a)||(a=[a]);var b,c=a.length,d=[],e=[];for(b=0;b<c;b++)this.hasTag(a[b])||e.push(a[b]);var f=this.tags||[];for(c=f.length,b=0;b<c;b++)a.indexOf(f[b])==-1&&d.push(f[b]);for(b=0;b<d.length;b++)this.removeTag(d[b]);for(b=0;b<e.length;b++)this.addTag(e[b])},ComponentTags.prototype.addTag=function(a){if(this.tags||(this.tags=[]),this.tags.indexOf(a)===-1){this.tags.push(a);var b=this;do{b.treeTags||(b.treeTags=new Map);var c=b.treeTags.get(a);if(!c){var c=new Set;b.treeTags.set(a,c)}c.add(this.component),b.clearCache(a)}while(b=b.parent)}},ComponentTags.prototype.removeTag=function(a){var b=this.tags.indexOf(a);if(b!==-1){this.tags.splice(b,1);var c=this;do{var d=c.treeTags.get(a);d&&(d.delete(this.component),c.clearCache(a))}while(c=c.parent)}},ComponentTags.prototype.hasTag=function(a){return this.tags&&this.tags.indexOf(a)!==-1},ComponentTags.prototype.tag=function(a){return this.mtag(a)[0]},ComponentTags.prototype.get=function(a){var b=this.treeTags.get(a);return b?Utils.setToArray(b):[]},ComponentTags.prototype.mtag=function(a){var b=null;if(this.cache&&(b=this.cache.get(a)),!b){if(a.indexOf(".")>=0){var c=a.split(".");b=this.get(c[0]);for(var d=1,e=c.length;b.length&&d<e;){for(var f=[],g=0,h=b.length;g<h;g++)f=f.concat(b[g].tags.get(c[d]));b=f,d++}}else b=this.get(a);this.cache||(this.cache=new Map),this.cache.set(a,b)}return b},ComponentText.prototype.set=function(a){this.settings.set(a),this.settings.hasUpdates&&this.updateTexture()},ComponentText.prototype.updateTexture=function(){if(""==this.settings.text)return void(this.component.texture=null);if(this.settings.hasUpdates=!1,!this.updatingTexture||this.component.texture!==this.texture){this.updatingTexture=!0;var a=this;this.component.texture=this.texture=this.stage.getTexture(function(b){return a.updatingTexture=!1,b(a.createTextureSource())})}},ComponentText.prototype.createTextureSource=function(){var a=new TextRenderer(this.stage,this.settings.clone()),b=this;return!a.settings.w&&this.component.w&&(a.settings.w=this.component.w),!a.settings.h&&this.component.h&&(a.settings.h=this.component.h),b.stage.textureManager.getTextureSource(function(b){var c=a.draw(),d=c.renderInfo;b(c.canvas,{renderInfo:d,precision:c.renderInfo.precision})},a.settings.getTextureId())},ComponentText.prototype.measure=function(){var a=new TextRenderer(this.stage,this.settings.clone());return!a.settings.w&&this.component.w&&(a.settings.w=this.component.w),!a.settings.h&&this.component.h&&(a.settings.h=this.component.h),a.draw(!0).renderInfo},Object.defineProperty(ComponentText.prototype,"renderInfo",{get:function(){return this.texture&&this.texture.source?this.texture.source.renderInfo:{}}}),Object.defineProperty(ComponentText.prototype,"text",{get:function(){return this.settings.text},set:function(a){this.settings.text=a,null===a?this.component.text=null:this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"w",{get:function(){return this.settings.w},set:function(a){this.settings.w=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"h",{get:function(){return this.settings.h},set:function(a){this.settings.h=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"fontStyle",{get:function(){return this.settings.fontStyle},set:function(a){this.settings.fontStyle=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"fontSize",{get:function(){return this.settings.fontSize},set:function(a){this.settings.fontSize=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"fontFace",{get:function(){return this.settings.fontFace},set:function(a){this.settings.fontFace=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"wordWrap",{get:function(){return this.settings.wordWrap},set:function(a){this.settings.wordWrap=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"wordWrapWidth",{get:function(){return this.settings.wordWrapWidth},set:function(a){this.settings.wordWrapWidth=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"lineHeight",{get:function(){return this.settings.lineHeight},set:function(a){this.settings.lineHeight=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"textBaseline",{get:function(){return this.settings.textBaseline},set:function(a){this.settings.textBaseline=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"textAlign",{get:function(){return this.settings.textAlign},set:function(a){this.settings.textAlign=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"offsetY",{get:function(){return this.settings.offsetY},set:function(a){this.settings.offsetY=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"maxLines",{get:function(){return this.settings.maxLines},set:function(a){this.settings.maxLines=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"maxLinesSuffix",{get:function(){return this.settings.maxLinesSuffix},set:function(a){this.settings.maxLinesSuffix=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"precision",{get:function(){return this.settings.precision},set:function(a){this.settings.precision=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"textColor",{get:function(){return this.settings.textColor},set:function(a){this.settings.textColor=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"paddingLeft",{get:function(){return this.settings.paddingLeft},set:function(a){this.settings.paddingLeft=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"paddingRight",{get:function(){return this.settings.paddingRight},set:function(a){this.settings.paddingRight=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"shadow",{get:function(){return this.settings.shadow},set:function(a){this.settings.shadow=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"shadowColor",{get:function(){return this.settings.shadowColor},set:function(a){this.settings.shadowColor=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"shadowOffsetX",{get:function(){return this.settings.shadowOffsetX},set:function(a){this.settings.shadowOffsetX=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"shadowOffsetY",{get:function(){return this.settings.shadowOffsetY},set:function(a){this.settings.shadowOffsetY=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"shadowBlur",{get:function(){return this.settings.shadowBlur},set:function(a){this.settings.shadowBlur=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"highlight",{get:function(){return this.settings.highlight},set:function(a){this.settings.highlight=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"highlightHeight",{get:function(){return this.settings.highlightHeight},set:function(a){this.settings.highlightHeight=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"highlightColor",{get:function(){return this.settings.highlightColor},set:function(a){this.settings.highlightColor=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"highlightOffset",{get:function(){return this.settings.highlightOffset},set:function(a){this.settings.highlightOffset=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"highlightPaddingLeft",{get:function(){return this.settings.highlightPaddingLeft},set:function(a){this.settings.highlightPaddingLeft=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"highlightPaddingRight",{get:function(){return this.settings.highlightPaddingRight},set:function(a){this.settings.highlightPaddingRight=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"cutSx",{get:function(){return this.settings.cutSx},set:function(a){this.settings.cutSx=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"cutEx",{get:function(){return this.settings.cutEx},set:function(a){this.settings.cutEx=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"cutSy",{get:function(){return this.settings.cutSy},set:function(a){this.settings.cutSy=a,this.settings.hasUpdates&&this.updateTexture()}}),Object.defineProperty(ComponentText.prototype,"cutEy",{get:function(){return this.settings.cutEy},set:function(a){this.settings.cutEy=a,this.settings.hasUpdates&&this.updateTexture()}}),TextRenderer.prototype.getPrecision=function(){return this.settings.precision||this.stage.defaultPrecision||1},TextRenderer.prototype.setFontProperties=function(a){var b=this.settings.fontFace||this.stage.defaultFontFace,c='"'+(Utils.isArray(b)?this.settings.fontFace.join('","'):b)+'"',d=a?this.getPrecision():1;this.context.font=this.settings.fontStyle+" "+this.settings.fontSize*d+"px "+c,this.context.textBaseline=this.settings.textBaseline},TextRenderer.prototype.createCanvas=function(){this.canvas=this.stage.adapter.getDrawingCanvas(),this.context=this.canvas.getContext("2d")},TextRenderer.prototype.unlinkCanvas=function(){this.canvas=null,this.context=null},TextRenderer.prototype.draw=function(a){this.createCanvas();var b={};this.setFontProperties(!1);var c=this.settings.w||2048/this.getPrecision(),d=c-(this.settings.paddingLeft+this.settings.paddingRight);d<10&&(c+=10-d,d+=10-d);var e,f=this.settings.wordWrapWidth||d;if(this.settings.wordWrap)e=this.wrapText(this.settings.text,f);else{e={l:this.settings.text.split(/(?:\r\n|\r|\n)/),n:[]};for(var g,h=e.l.length,g=0;g<h-1;g++)e.n.push(g)}var i=e.l;if(this.settings.maxLines&&i.length>this.settings.maxLines){var j=i.slice(0,this.settings.maxLines),k=null;if(this.settings.maxLinesSuffix){var l=this.wrapText(j[j.length-1]+this.settings.maxLinesSuffix,f);j[j.length-1]=l.l[0],k=[l.l.length>1?l.l[1]:""]}else k=[""];var g,h=i.length,m=0,n=e.n.length;for(g=this.settings.maxLines;g<h;g++)k[m]+=(k[m]?" ":"")+i[g],g+1<n&&e.n[g+1]&&m++;b.remainingText=k.join("\n"),b.moreTextLines=!0,i=j}else b.moreTextLines=!1,b.remainingText="";for(var o=0,p=[],g=0;g<i.length;g++){var q=this.context.measureText(i[g]).width;p.push(q),o=Math.max(o,q)}b.lineWidths=p,this.settings.w||(c=o+this.settings.paddingLeft+this.settings.paddingRight,d=o);var r,s=this.settings.lineHeight||this.settings.fontSize;r=this.settings.h?this.settings.h:s*(i.length-1)+.5*this.settings.fontSize+Math.max(s,this.settings.fontSize)+this.settings.offsetY;var t=null===this.settings.offsetY?this.settings.fontSize:this.settings.offsetY,u=this.getPrecision();if(b.w=c*u,b.h=r*u,b.lines=i,b.precision=u,!a){c||(c=1),r||(r=1),(this.settings.cutSx||this.settings.cutEx)&&(c=Math.min(c,this.settings.cutEx-this.settings.cutSx)),(this.settings.cutSy||this.settings.cutEy)&&(r=Math.min(r,this.settings.cutEy-this.settings.cutSy)),this.canvas.width=Math.ceil(c*u),this.canvas.height=Math.ceil(r*u),this.setFontProperties(!0),(this.settings.cutSx||this.settings.cutSy)&&this.context.translate(-(this.settings.cutSx*u),-(this.settings.cutSy*u));var v,w,x=[];for(g=0;g<i.length;g++)v=0,w=g*s+t,"right"===this.settings.textAlign?v+=d-p[g]:"center"===this.settings.textAlign&&(v+=(d-p[g])/2),v+=this.settings.paddingLeft,x.push({text:i[g],x:v*u,y:w*u,w:p[g]*u});if(this.settings.highlight){var y=this.settings.highlightColor||0,z=this.settings.highlightHeight||1.5*this.settings.fontSize,A=null!==this.settings.highlightOffset?this.settings.highlightOffset:-.5*this.settings.fontSize,B=null!==this.settings.highlightPaddingLeft?this.settings.highlightPaddingLeft:this.settings.paddingLeft,C=null!==this.settings.highlightPaddingRight?this.settings.highlightPaddingRight:this.settings.paddingRight;for(this.context.fillStyle=StageUtils.getRgbaString(y),g=0;g<x.length;g++){var D=x[g];this.context.fillRect((D.x-B)*u,(D.y+A)*u,(D.w+C+B)*u,z*u)}}var E=null;for(this.settings.shadow&&(E=[this.context.shadowColor,this.context.shadowOffsetX,this.context.shadowOffsetY,this.context.shadowBlur],this.context.shadowColor=StageUtils.getRgbaString(this.settings.shadowColor),this.context.shadowOffsetX=this.settings.shadowOffsetX*u,this.context.shadowOffsetY=this.settings.shadowOffsetY*u,this.context.shadowBlur=this.settings.shadowBlur*u),this.context.fillStyle=StageUtils.getRgbaString(this.settings.textColor),g=0;g<x.length;g++){var D=x[g];this.context.fillText(D.text,D.x,D.y)}E&&(this.context.shadowColor=E[0],this.context.shadowOffsetX=E[1],this.context.shadowOffsetY=E[2],this.context.shadowBlur=E[3]),(this.settings.cutSx||this.settings.cutSy)&&this.context.translate(this.settings.cutSx,this.settings.cutSy)}var F=this.canvas;return this.unlinkCanvas(),{renderInfo:b,
canvas:F}},TextRenderer.prototype.wrapText=function(a,b){for(var c=a.split(/\r?\n/g),d=[],e=[],f=0;f<c.length;f++){for(var g=[],h="",i=b,j=c[f].split(" "),k=0;k<j.length;k++){var l=this.context.measureText(j[k]).width,m=l+this.context.measureText(" ").width;0===k||m>i?(k>0&&(g.push(h),h=""),h+=j[k],i=b-l):(i-=m,h+=" "+j[k])}h&&(g.push(h),h=""),d=d.concat(g),f<c.length-1&&e.push(d.length)}return{l:d,n:e}};var TextRendererSettings=function(){this.text=this._text="",this.w=this._w=0,this.h=this._h=0,this.fontStyle=this._fontStyle="normal",this.fontSize=this._fontSize=40,this.fontFace=this._fontFace=null,this.wordWrap=this._wordWrap=!0,this.wordWrapWidth=this._wordWrapWidth=0,this.lineHeight=this._lineHeight=null,this.textBaseline=this._textBaseline="alphabetic",this.textAlign=this._textAlign="left",this.offsetY=this._offsetY=null,this.maxLines=this._maxLines=0,this.maxLinesSuffix=this._maxLinesSuffix="..",this.precision=this._precision=null,this.textColor=this._textColor=4294967295,this.paddingLeft=this._paddingLeft=0,this.paddingRight=this._paddingRight=0,this.shadow=this._shadow=!1,this.shadowColor=this._shadowColor=4278190080,this.shadowOffsetX=this._shadowOffsetX=0,this.shadowOffsetY=this._shadowOffsetY=0,this.shadowBlur=this._shadowBlur=5,this.highlight=this._highlight=!1,this.highlightHeight=this._highlightHeight=0,this.highlightColor=this._highlightColor=4278190080,this.highlightOffset=this._highlightOffset=null,this.highlightPaddingLeft=this._highlightPaddingLeft=null,this.highlightPaddingRight=this._highlightPaddingRight=null,this.cutSx=this._cutSx=0,this.cutEx=this._cutEx=0,this.cutSy=this._cutSy=0,this.cutEy=this._cutEy=0,this.hasUpdates=!1};TextRendererSettings.prototype.set=function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=a[b[c]];this.setSetting(b[c],d)}},TextRendererSettings.prototype.setSetting=function(a,b){var c=TextRendererSettings.SETTINGS[a];c?c.s(this,b):console.warn("Unknown text property: "+a)},TextRendererSettings.prototype.getNonDefaults=function(){var a={};return""!==this.text&&(a.text=this.text),0!==this.w&&(a.w=0),0!==this.h&&(a.h=0),"normal"!==this.fontStyle&&(a.fontStyle=this.fontStyle),40!==this.fontSize&&(a.fontSize=this.fontSize),null!==this.fontFace&&(a.fontFace=this.fontFace),this.wordWrap!==!0&&(a.wordWrap=this.wordWrap),0!==this.wordWrapWidth&&(a.wordWrapWidth=this.wordWrapWidth),null!==this.lineHeight&&(a.lineHeight=this.lineHeight),"alphabetic"!==this.textBaseline&&(a.textBaseline=this.textBaseline),"left"!==this.textAlign&&(a.textAlign=this.textAlign),null!==this.offsetY&&(a.offsetY=this.offsetY),0!==this.maxLines&&(a.maxLines=this.maxLines),".."!==this.maxLinesSuffix&&(a.maxLinesSuffix=this.maxLinesSuffix),null!==this.precision&&(a.precision=this.precision),4294967295!==this.textColor&&(a.textColor=this.textColor),0!==this.paddingLeft&&(a.paddingLeft=this.paddingLeft),0!==this.paddingRight&&(a.paddingRight=this.paddingRight),this.shadow!==!1&&(a.shadow=this.shadow),4278190080!==this.shadowColor&&(a.shadowColor=this.shadowColor),0!==this.shadowOffsetX&&(a.shadowOffsetX=this.shadowOffsetX),0!==this.shadowOffsetY&&(a.shadowOffsetY=this.shadowOffsetY),5!==this.shadowBlur&&(a.shadowBlur=this.shadowBlur),this.highlight!==!1&&(a.highlight=this.highlight),0!==this.highlightHeight&&(a.highlightHeight=this.highlightHeight),4278190080!==this.highlightColor&&(a.highlightColor=this.highlightColor),null!==this.highlightOffset&&(a.highlightOffset=this.highlightOffset),null!==this.highlightPaddingLeft&&(a.highlightPaddingLeft=this.highlightPaddingLeft),null!==this.highlightPaddingRight&&(a.highlightPaddingRight=this.highlightPaddingRight),this.cutSx&&(a.cutSx=this.cutSx),this.cutEx&&(a.cutEx=this.cutEx),this.cutSy&&(a.cutSy=this.cutSy),this.cutEy&&(a.cutEy=this.cutEy),a},TextRendererSettings.prototype.getTextureId=function(){var a=[];return 0!==this.w&&a.push("w "+this.w),0!==this.h&&a.push("h "+this.h),"normal"!==this.fontStyle&&a.push("fS"+this.fontStyle),40!==this.fontSize&&a.push("fs"+this.fontSize),null!==this.fontFace&&a.push("ff"+(Utils.isArray(this.fontFace)?this.fontFace.join(","):this.fontFace)),this.wordWrap!==!0&&a.push("wr"+(this.wordWrap?1:0)),0!==this.wordWrapWidth&&a.push("ww"+this.wordWrapWidth),null!==this.lineHeight&&a.push("lh"+this.lineHeight),"alphabetic"!==this.textBaseline&&a.push("tb"+this.textBaseline),"left"!==this.textAlign&&a.push("ta"+this.textAlign),null!==this.offsetY&&a.push("oy"+this.offsetY),0!==this.maxLines&&a.push("ml"+this.maxLines),".."!==this.maxLinesSuffix&&a.push("ms"+this.maxLinesSuffix),null!==this.precision&&a.push("pc"+this.precision),4294967295!==this.textColor&&a.push("co"+this.textColor.toString(16)),0!==this.paddingLeft&&a.push("pl"+this.paddingLeft),0!==this.paddingRight&&a.push("pr"+this.paddingRight),this.shadow!==!1&&a.push("sh"+(this.shadow?1:0)),4278190080!==this.shadowColor&&a.push("sc"+this.shadowColor.toString(16)),0!==this.shadowOffsetX&&a.push("sx"+this.shadowOffsetX),0!==this.shadowOffsetY&&a.push("sy"+this.shadowOffsetY),5!==this.shadowBlur&&a.push("sb"+this.shadowBlur),this.highlight!==!1&&a.push("hL"+(this.highlight?1:0)),0!==this.highlightHeight&&a.push("hh"+this.highlightHeight),4278190080!==this.highlightColor&&a.push("hc"+this.highlightColor.toString(16)),null!==this.highlightOffset&&a.push("ho"+this.highlightOffset),null!==this.highlightPaddingLeft&&a.push("hl"+this.highlightPaddingLeft),null!==this.highlightPaddingRight&&a.push("hr"+this.highlightPaddingRight),this.cutSx&&a.push("csx"+this.cutSx),this.cutEx&&a.push("cex"+this.cutEx),this.cutSy&&a.push("csy"+this.cutSy),this.cutEy&&a.push("cey"+this.cutEy),"TX$"+a.join("|")+":"+this.text},TextRendererSettings.prototype.clone=function(){var a=new TextRendererSettings;return a.set(this.getNonDefaults()),a},TextRendererSettings.prototype.notifyUpdate=function(){this.hasUpdates=!0},Object.defineProperty(TextRendererSettings.prototype,"text",{get:function(){return this._text},set:function(a){this._text!==a&&(this._text=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"w",{get:function(){return this._w},set:function(a){this._w!==a&&(this._w=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"h",{get:function(){return this._h},set:function(a){this._h!==a&&(this._h=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(a){this._fontStyle!==a&&(this._fontStyle=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"fontSize",{get:function(){return this._fontSize},set:function(a){this._fontSize!==a&&(this._fontSize=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"fontFace",{get:function(){return this._fontFace},set:function(a){this._fontFace!==a&&(this._fontFace=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(a){this._wordWrap!==a&&(this._wordWrap=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(a){this._wordWrapWidth!==a&&(this._wordWrapWidth=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(a){this._lineHeight!==a&&(this._lineHeight=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(a){this._textBaseline!==a&&(this._textBaseline=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"textAlign",{get:function(){return this._textAlign},set:function(a){this._textAlign!==a&&(this._textAlign=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"offsetY",{get:function(){return this._offsetY},set:function(a){this._offsetY!==a&&(this._offsetY=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"maxLines",{get:function(){return this._maxLines},set:function(a){this._maxLines!==a&&(this._maxLines=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"maxLinesSuffix",{get:function(){return this._maxLinesSuffix},set:function(a){this._maxLinesSuffix!==a&&(this._maxLinesSuffix=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"precision",{get:function(){return this._precision},set:function(a){this._precision!==a&&(this._precision=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"textColor",{get:function(){return this._textColor},set:function(a){this._textColor!==a&&(this._textColor=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"paddingLeft",{get:function(){return this._paddingLeft},set:function(a){this._paddingLeft!==a&&(this._paddingLeft=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"paddingRight",{get:function(){return this._paddingRight},set:function(a){this._paddingRight!==a&&(this._paddingRight=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"shadow",{get:function(){return this._shadow},set:function(a){this._shadow!==a&&(this._shadow=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(a){this._shadowColor!==a&&(this._shadowColor=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"shadowOffsetX",{get:function(){return this._shadowOffsetX},set:function(a){this._shadowOffsetX!==a&&(this._shadowOffsetX=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"shadowOffsetY",{get:function(){return this._shadowOffsetY},set:function(a){this._shadowOffsetY!==a&&(this._shadowOffsetY=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"shadowBlur",{get:function(){return this._shadowBlur},set:function(a){this._shadowBlur!==a&&(this._shadowBlur=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"highlight",{get:function(){return this._highlight},set:function(a){this._highlight!==a&&(this._highlight=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"highlightHeight",{get:function(){return this._highlightHeight},set:function(a){this._highlightHeight!==a&&(this._highlightHeight=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"highlightColor",{get:function(){return this._highlightColor},set:function(a){this._highlightColor!==a&&(this._highlightColor=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"highlightOffset",{get:function(){return this._highlightOffset},set:function(a){this._highlightOffset!==a&&(this._highlightOffset=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"highlightPaddingLeft",{get:function(){return this._highlightPaddingLeft},set:function(a){this._highlightPaddingLeft!==a&&(this._highlightPaddingLeft=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"highlightPaddingRight",{get:function(){return this._highlightPaddingRight},set:function(a){this._highlightPaddingRight!==a&&(this._highlightPaddingRight=a,this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"cutSx",{get:function(){return this._cutSx},set:function(a){this._cutSx!==a&&(this._cutSx=Math.max(0,a),this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"cutEx",{get:function(){return this._cutEx},set:function(a){this._cutEx!==a&&(this._cutEx=Math.max(0,a),this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"cutSy",{get:function(){return this._cutSy},set:function(a){this._cutSy!==a&&(this._cutSy=Math.max(0,a),this.notifyUpdate())}}),Object.defineProperty(TextRendererSettings.prototype,"cutEy",{get:function(){return this._cutEy},set:function(a){this._cutEy!==a&&(this._cutEy=Math.max(0,a),this.notifyUpdate())}}),TextRendererSettings.SETTINGS={text:{s:function(a,b){a.text=b},m:null},w:{s:function(a,b){a.w=b},m:null},h:{s:function(a,b){a.h=b},m:null},fontStyle:{s:function(a,b){a.fontStyle=b},m:null},fontSize:{s:function(a,b){a.fontSize=b},m:null},fontFace:{s:function(a,b){a.fontFace=b},m:null},wordWrap:{s:function(a,b){a.wordWrap=b},m:null},wordWrapWidth:{s:function(a,b){a.wordWrapWidth=b},m:null},lineHeight:{s:function(a,b){a.lineHeight=b},m:null},textBaseline:{s:function(a,b){a.textBaseline=b},m:null},textAlign:{s:function(a,b){a.textAlign=b},m:null},offsetY:{s:function(a,b){a.offsetY=b},m:null},maxLines:{s:function(a,b){a.maxLines=b},m:null},maxLinesSuffix:{s:function(a,b){a.maxLinesSuffix=b},m:null},precision:{s:function(a,b){a.precision=b},m:null},textColor:{s:function(a,b){a.textColor=b},m:null},paddingLeft:{s:function(a,b){a.paddingLeft=b},m:null},paddingRight:{s:function(a,b){a.paddingRight=b},m:null},shadow:{s:function(a,b){a.shadow=b},m:null},shadowColor:{s:function(a,b){a.shadowColor=b},m:null},shadowOffsetX:{s:function(a,b){a.shadowOffsetX=b},m:null},shadowOffsetY:{s:function(a,b){a.shadowOffsetY=b},m:null},shadowBlur:{s:function(a,b){a.shadowBlur=b},m:null},highlight:{s:function(a,b){a.highlight=b},m:null},highlightHeight:{s:function(a,b){a.highlightHeight=b},m:null},highlightColor:{s:function(a,b){a.highlightColor=b},m:null},highlightOffset:{s:function(a,b){a.highlightOffset=b},m:null},highlightPaddingLeft:{s:function(a,b){a.highlightPaddingLeft=b},m:null},highlightPaddingRight:{s:function(a,b){a.highlightPaddingRight=b},m:null},cutSx:{s:function(a,b){a.cutSx=b},m:null},cutEx:{s:function(a,b){a.cutEx=b},m:null},cutSy:{s:function(a,b){a.cutSy=b},m:null},cutEy:{s:function(a,b){a.cutEy=b},m:null}},Utils.extendClass(Transition,EventEmitter),Transition.prototype.reset=function(a,b,c){this.startValue=a,this.targetValue=b,this.p=c,this.isActive()?this.activate():1===c&&(this.setValue(this.getDrawValue()),this.invokeListeners())},Transition.prototype.isActive=function(){return this.p<1},Transition.prototype.updateTargetValue=function(a,b){a===b?this.reset(b,a,1):(this.targetValue=a,this.startValue=b,this.p=0,this.delayLeft=this.delay,this._eventsCount&&this.emit("start"),this.isActive()&&this.activate())},Transition.prototype.activate=function(){},Transition.prototype.progress=function(a){if(this.p<1){if(this.delayLeft>0){if(this.delayLeft-=a,!(this.delayLeft<0))return;a=-this.delayLeft,this.delayLeft=0,this._eventsCount&&this.emit("delayEnd")}0==this.duration?this.p=1:this.p+=a/this.duration,this.p>=1&&(this.p=1)}this.setValue(this.getDrawValue()),this.invokeListeners()},Transition.prototype.invokeListeners=function(){this._eventsCount&&this.emit("progress",this.p),1===this.p&&this._eventsCount&&this.emit("finish")},Transition.prototype.setValuesDynamic=function(a,b){var c=this._timingFunctionImpl(this.p);1==c?this.targetValue=a:0==c?(this.targetValue=a,this.startValue=b,this.targetValue=a):(this.targetValue=a,this.targetValue=a,this.startValue=a-(a-b)/(1-c))},Transition.prototype.set=function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=b[c],e=a[d];this.setSetting(d,e)}},Transition.prototype.setSetting=function(a,b){if(void 0===this[a])throw new TypeError("Unknown property:"+a);this[a]=b},Transition.prototype.getProgress=function(){return this.p},Transition.prototype.getDrawValue=function(){if(this.p>=1)return this.targetValue;var a=this._timingFunctionImpl(this.p);return this.getMergedValue(a)},Transition.prototype.setValue=function(a){},Transition.prototype.getMergedValue=function(a){return this.targetValue*a+this.startValue*(1-a)},Object.defineProperty(Transition.prototype,"delay",{get:function(){return this._delay},set:function(a){if(!Utils.isNumber(a))throw new TypeError("delay must be a number");this._delay=a}}),Object.defineProperty(Transition.prototype,"duration",{get:function(){return this._duration},set:function(a){if(!Utils.isNumber(a))throw new TypeError("duration must be a number");this._duration=a}}),Object.defineProperty(Transition.prototype,"timingFunction",{get:function(){return this._timingFunction},set:function(a){a!==this._timingFunction&&(this._timingFunction=a,this._timingFunctionImpl=StageUtils.getTimingFunction(a))}}),Utils.extendClass(PropertyTransition,Transition),PropertyTransition.prototype.setValue=function(a){this.valueSetterFunction(this.component,a)},PropertyTransition.prototype.getMergedValue=function(a){return this.mergeFunction(this.targetValue,this.startValue,a)},PropertyTransition.prototype.activate=function(){this.component.stage.addActiveTransition(this)},Animation.prototype.set=function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=b[c],e=a[d];this.setSetting(d,e)}},Animation.prototype.setSetting=function(a,b){switch(a){case"actions":this.actions=[];for(var c=0,d=b.length;c<d;c++)this.add(b[c]);break;default:if(void 0===this[a])throw new TypeError("Unknown property:"+a);this[a]=b}},Animation.prototype.add=function(a){var b=new AnimationAction(this);return b.set(a),this.actions.push(b),b},Animation.prototype.remove=function(a){var b=this.actions.indexOf(a);b>=0&&this.actions.splice(b,1)},Animation.prototype.get=function(a){return this.actions[a]},Animation.prototype.getProgress=function(){return this.p},Animation.prototype.getFrameForProgress=function(a){return Math.round(a*this.duration*60)},Animation.prototype.applyTransforms=function(){for(var a=this.actions.length,b=0;b<a;b++)this.actions[b].applyTransforms(this.p,1)},Animation.prototype.resetTransforms=function(){for(var a=this.actions.length,b=0;b<a;b++)this.actions[b].resetTransforms()},Object.defineProperty(Animation.prototype,"subject",{get:function(){return this._subject},set:function(a){this._subject=a}}),AnimationAction.prototype.getAnimatedComponents=function(){var a=this.tags.length;return this.animation.subject&&a?1===a?""==this.tags[0]?[this.animation.subject]:this.animation.subject.mtag(this.tags[0]):this.getAnimatedMultiComponents():[]},AnimationAction.prototype.getAnimatedMultiComponents=function(){var a,b,c,d=this.tags.length,e=[];for(a=0;a<d;a++)if(""===this.tags[a])e.push(this.animation.subject);else{var f=this.animation.subject.mtag(this.tags[a]);for(c=f.length,b=0;b<c;b++)e.push(f[b])}return e},AnimationAction.prototype.setValue=function(a){this._items.parseDefinition(a)},AnimationAction.prototype.getItem=function(a){var b=this._items.length;if(!b)return null;if(a<this._items[0].p)return null;for(var c=0;c<b;c++)if(this._items[c].p<=a&&a<this._items[c].pe)return this._items[c];return this._items[b-1]},AnimationAction.prototype.getResetValue=function(){return this.hasResetValue?this.resetValue:this._items.length?this._items.lv[0]:0},AnimationAction.prototype.applyTransforms=function(a){if(this._properties.length){var b=this.getAnimatedComponents();if(b.length){var c=this._items.getCurrentValue();if(void 0!==c){if(1!==a){var d=this.getResetValue();this.mergeFunction&&(c=this.mergeFunction(c,d,a))}for(var e=this._properties.length,f=b.length,g=0;g<e;g++)for(var h=0;h<f;h++)this._properties[g].s&&this._properties[g].s(b[h],c)}}}},AnimationAction.prototype.resetTransforms=function(){if(this._properties.length)for(var a=this.getResetValue(),b=this._properties.length,c=this.getAnimatedComponents(),d=c.length,e=0;e<b;e++)for(var f=0;f<d;f++)this._properties[e].s&&this._properties[e].s(c[f],a)},AnimationAction.prototype.set=function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=b[c],e=a[d];this.setSetting(d,e)}},AnimationAction.prototype.setSetting=function(a,b){switch(a){case"value":case"v":this.value=b;break;default:if(void 0===this[a])throw new TypeError("Unknown property:"+a);this[a]=b}},Object.defineProperty(AnimationAction.prototype,"tags",{get:function(){return this._tags},set:function(a){Utils.isArray(a)||(a=[a]),this._tags=a}}),Object.defineProperty(AnimationAction.prototype,"tag",{get:function(){return this.tags},set:function(a){this.tags=a}}),Object.defineProperty(AnimationAction.prototype,"t",{get:function(){return this.tags},set:function(a){this.tags=a}}),Object.defineProperty(AnimationAction.prototype,"properties",{get:function(){return this._properties},set:function(a){var b=a;Utils.isArray(a)||(b=[b]);for(var c=[],d=b.length,e=0;e<d;e++){if(a=b[e],!Utils.isString(a))throw new TypeError("property must be a string");if(Component.propAliases.has(a))for(var f=Component.propAliases.get(a),g=0,h=f.length;g<h;g++)c.push({n:f[g]});else c.push({n:a})}this.mergeFunction=null;var i=!1;for(e=0,d=c.length;e<d;e++){var j=c[e],k=j.n,l=k.indexOf(".");l>=0?(j.o=k.substr(0,l),j.n=k.substr(l+1)):j.o="component";var m=null;switch(j.o){case"text":m=TextRendererSettings.SETTINGS[j.n],m&&(j.s=function(a,b){m.s(a.text,b)});break;case"displayedTexture":m=Texture.SETTINGS[j.n],m&&(j.s=function(a,b){a.displayedTexture&&m.s(a.displayedTexture,b)});break;case"texture":m=Texture.SETTINGS[j.n],m&&(j.s=function(a,b){a.texture&&m.s(a.texture,b)});break;case"component":m=Component.SETTINGS[j.n],m&&(j.s=m.s)}m?0==e?this.mergeFunction=m.m:m.m!==this.mergeFunction&&(i=!0):(console.error("Unknown animation property:"+(j.o?j.o+".":"")+j.n),c.splice(e,1),e--,d--)}i&&(console.error("You can't mix mergable and non-mergable properties in an animation action ("+c.map(function(a){return(a.o?a.o+".":"")+a.n}).join(",")+")"),this.mergeFunction=null),this._properties=c}}),Object.defineProperty(AnimationAction.prototype,"property",{get:function(){return this.properties},set:function(a){this.properties=a}}),Object.defineProperty(AnimationAction.prototype,"p",{get:function(){return this.properties},set:function(a){this.properties=a}}),Object.defineProperty(AnimationAction.prototype,"value",{set:function(a){this.setValue(a)}}),Object.defineProperty(AnimationAction.prototype,"v",{set:function(a){this.value=a}}),Object.defineProperty(AnimationAction.prototype,"resetValue",{get:function(){return this._resetValue},set:function(a){this._resetValue=a,this.hasResetValue=!0}}),Object.defineProperty(AnimationAction.prototype,"rv",{get:function(){return this.resetValue},set:function(a){this.resetValue=a}});var isNode=!("undefined"==typeof module||!module.exports),AnimationActionItems=function(a){this.animationAction=a,this.clear()};AnimationActionItems.prototype.clear=function(){this.p=[],this.pe=[],this.idp=[],this.f=[],this.v=[],this.lv=[],this.sm=[],this.s=[],this.ve=[],this.sme=[],this.se=[],this.length=0},AnimationActionItems.prototype.push=function(a){this.p.push(a.p||0),this.pe.push(a.pe||0),this.idp.push(a.idp||0),this.f.push(a.f||!1),this.v.push(a.v||0),this.lv.push(a.lv||0),this.sm.push(a.sm||0),this.s.push(a.s||0),this.ve.push(a.ve||0),this.sme.push(a.sme||0),this.se.push(a.se||0),this.length++},AnimationActionItems.prototype.parseDefinition=function(a){var b,c;Utils.isPlainObject(a)||(a={0:a});var d=[];for(var e in a)if(a.hasOwnProperty(e)){var f=a[e];Utils.isPlainObject(f)||(f={v:f});var g=parseFloat(e);!isNaN(g)&&g>=0&&g<=1&&(f.p=g,f.f=Utils.isFunction(f.v),f.lv=f.f?f.v(0,0):f.v,d.push(f))}for(d=d.sort(function(a,b){return a.p-b.p}),c=d.length,b=0;b<c;b++){var h=b==c-1;if(d[b].hasOwnProperty("pe")){var i=b<c-1?d[b+1].p:1;d[b].pe>i&&(d[b].pe=i)}else d[b].pe=h?1:d[b+1].p;d[b].pe===d[b].p?d[b].idp=0:d[b].idp=1/(d[b].pe-d[b].p)}if(this.animationAction.mergeFunction){var j=this.animationAction.mergeFunction===StageUtils.mergeColors;for(b=0;b<c;b++)if(d[b].hasOwnProperty("sm")||(d[b].sm=.5),!d[b].hasOwnProperty("s"))if(0===b||b===c-1)d[b].s=j?[0,0,0,0]:0;else{var k=d[b-1],l=d[b+1];if(k.p===l.p)d[b].s=j?[0,0,0,0]:0;else if(j){var m=StageUtils.getRgbaComponents(l.lv),n=StageUtils.getRgbaComponents(k.lv),o=1/(l.p-k.p);d[b].s=[o*(m[0]-n[0]),o*(m[1]-n[1]),o*(m[2]-n[2]),o*(m[3]-n[3])]}else d[b].s=(l.lv-k.lv)/(l.p-k.p)}for(b=0;b<c-1;b++)if(!d[b].f){var h=b===c-1;d[b].hasOwnProperty("sme")||(d[b].sme=h?.5:d[b+1].sm),d[b].hasOwnProperty("se")||(d[b].se=h?j?[0,0,0,0]:0:d[b+1].s),d[b].hasOwnProperty("ve")||(d[b].ve=h?d[b].lv:d[b+1].lv),d[b].v=j?StageUtils.getSplineRgbaValueFunction(d[b].v,d[b].ve,d[b].p,d[b].pe,d[b].sm,d[b].sme,d[b].s,d[b].se):StageUtils.getSplineValueFunction(d[b].v,d[b].ve,d[b].p,d[b].pe,d[b].sm,d[b].sme,d[b].s,d[b].se),d[b].f=!0}}for(this.length&&this.clear(),b=0,c=d.length;b<c;b++)this.push(d[b])},AnimationActionItems.prototype.getCurrentItem=function(){var a=this.animationAction.animation.p,b=this.length;if(!b)return-1;if(a<this.p[0])return-1;for(var c=0;c<b;c++)if(this.p[c]<=a&&a<this.pe[c])return c;return b-1},AnimationActionItems.prototype.getCurrentValue=function(){var a=this.animationAction.animation.p,b=this.getCurrentItem();if(b!=-1){if(this.f[b]){var c=(a-this.p[b])*this.idp[b];return this.v[b](c)}return this.v[b]}};var TimedAnimation=function(a){Animation.call(this,a),EventEmitter.call(this),this._delay=0,this._duration=1,this._repeat=0,this._repeatOffset=0,this._repeatDelay=0,this.delayLeft=0,this.repeatsLeft=0,this._autostop=!1,this._stopMethod=TimedAnimation.STOP_METHODS.FADE,this._stopMethodOptions={},this.stopDelayLeft=0,this.state=TimedAnimation.STATES.IDLE,this.stoppingProgressTransition=new Transition(0)};Utils.extendClass(TimedAnimation,Animation),TimedAnimation.prototype=Object.assign(TimedAnimation.prototype,EventEmitter.prototype),TimedAnimation.prototype.isActive=function(){return this.subject&&(this.state==TimedAnimation.STATES.PLAYING||this.state==TimedAnimation.STATES.STOPPING)},TimedAnimation.prototype.activate=function(){this.component.stage.addActiveAnimation(this)},TimedAnimation.prototype.progress=function(a){if(this.subject){if(this.state==TimedAnimation.STATES.STOPPING)return void this.stopProgress(a);if(this.state==TimedAnimation.STATES.PLAYING){if(this.delayLeft>0){if(this.delayLeft-=a,!(this.delayLeft<0))return;a=-this.delayLeft,this.delayLeft=0,this._eventsCount&&this.emit("delayEnd")}0===this.duration?this.p=1:this.duration>0&&(this.p+=a/this.duration),this.p>=1?this.repeat==-1||this.repeatsLeft>0?(this.repeatsLeft>0&&this.repeatsLeft--,this.p=this.repeatOffset,this.repeatDelay&&(this.delayLeft=this.repeatDelay),this._eventsCount&&this.emit("repeat",this.repeatsLeft)):(this.p=1,this.state=TimedAnimation.STATES.FINISHED,this._eventsCount&&this.emit("finish"),this.autostop&&this.stop()):this._eventsCount&&this.emit("progress",this.p)}}},TimedAnimation.prototype.stopProgress=function(a){var b=void 0===this.stopMethodOptions.duration?this.duration:this.stopMethodOptions.duration;if(this.delayLeft>0&&(this.state=TimedAnimation.STATES.STOPPED,this._eventsCount&&this.emit("stopFinish")),this.stopDelayLeft>0){if(this.stopDelayLeft-=a,!(this.stopDelayLeft<0))return;a=-this.stopDelayLeft,this.stopDelayLeft=0,this._eventsCount&&this.emit("stopDelayEnd")}this.stopMethod==TimedAnimation.STOP_METHODS.IMMEDIATE?(this.state=TimedAnimation.STATES.STOPPED,this._eventsCount&&this.emit("stop"),this._eventsCount&&this.emit("stopFinish")):this.stopMethod==TimedAnimation.STOP_METHODS.REVERSE?(0===b?this.p=0:b>0&&(this.p-=a/b),this.p<=0&&(this.p=0,this.state=TimedAnimation.STATES.STOPPED,this._eventsCount&&this.emit("stopFinish"))):this.stopMethod==TimedAnimation.STOP_METHODS.FADE?(this.stoppingProgressTransition.progress(a),this.stoppingProgressTransition.p>=1&&(this.state=TimedAnimation.STATES.STOPPED,this._eventsCount&&this.emit("stopFinish"))):this.stopMethod==TimedAnimation.STOP_METHODS.ONETOTWO?this.p<2&&(0===b?this.p=2:b>0&&(this.p<1?this.p+=a/this.duration:this.p+=a/b),this.p>=2?(this.p=2,this.state=TimedAnimation.STATES.STOPPED,this._eventsCount&&this.emit("stopFinish")):this._eventsCount&&this.emit("progress",this.p)):this.p<1&&(0==b?this.p=1:this.p+=a/b,this.p>=1?this.stopMethod==TimedAnimation.STOP_METHODS.FORWARD?(this.p=1,this.state=TimedAnimation.STATES.STOPPED,this._eventsCount&&this.emit("stopFinish")):this.repeatsLeft>0?(this.repeatsLeft--,this.p=0,this._eventsCount&&this.emit("repeat",this.repeatsLeft)):(this.p=1,this.state=TimedAnimation.STATES.STOPPED,this._eventsCount&&this.emit("stopFinish")):this._eventsCount&&this.emit("progress",this.p))},TimedAnimation.prototype.start=function(){this.p=0,this.delayLeft=this.delay,this.repeatsLeft=this.repeat,this.state=TimedAnimation.STATES.PLAYING,this._eventsCount&&this.emit("start"),this.subject&&this.stage.addActiveAnimation(this)},TimedAnimation.prototype.fastForward=function(){this.state===TimedAnimation.STATES.PLAYING?(this.delayLeft=0,this.p=1):this.state===TimedAnimation.STATES.STOPPING&&(this.stopDelayLeft=0,this.p=0)},TimedAnimation.prototype.play=function(){this.state==TimedAnimation.STATES.STOPPING&&this.stopMethod==TimedAnimation.STOP_METHODS.REVERSE?(this.state=TimedAnimation.STATES.PLAYING,this._eventsCount&&this.emit("stopContinue")):this.state!=TimedAnimation.STATES.PLAYING&&this.state!=TimedAnimation.STATES.FINISHED&&this.start()},TimedAnimation.prototype.replay=function(){this.state==TimedAnimation.STATES.FINISHED?this.start():this.play()},TimedAnimation.prototype.isPlaying=function(){return this.state===TimedAnimation.STATES.PLAYING},TimedAnimation.prototype.skipDelay=function(){this.delayLeft=0,this.stopDelayLeft=0},TimedAnimation.prototype.stop=function(){this.state!==TimedAnimation.STATES.STOPPED&&this.state!==TimedAnimation.STATES.IDLE&&(this.subject&&this.stage.addActiveAnimation(this),this.stopDelayLeft=this.stopMethodOptions.delay||0,this.stopMethod==TimedAnimation.STOP_METHODS.IMMEDIATE&&!this.stopDelayLeft||this.delayLeft>0?(this.state=TimedAnimation.STATES.STOPPING,this._eventsCount&&this.emit("stop")):(this.stopMethod==TimedAnimation.STOP_METHODS.FADE&&(this.stopMethodOptions.duration&&(this.stoppingProgressTransition.duration=this.stopMethodOptions.duration),this.stopMethodOptions.timingFunction&&(this.stoppingProgressTransition.timingFunction=this.stopMethodOptions.timingFunction),this.stoppingProgressTransition.reset(0,1,0)),this.state=TimedAnimation.STATES.STOPPING,this._eventsCount&&this.emit("stop")))},TimedAnimation.prototype.stopNow=function(){this.state===TimedAnimation.STATES.STOPPED&&this.state===TimedAnimation.STATES.IDLE||(this.state=TimedAnimation.STATES.STOPPING,this.p=0,this._eventsCount&&this.emit("stop"),this.resetTransforms(),this.state=TimedAnimation.STATES.STOPPED,this._eventsCount&&this.emit("stopFinish"))},TimedAnimation.prototype.applyTransforms=function(){if(this.state==TimedAnimation.STATES.STOPPED)for(var a=this.actions.length,b=0;b<a;b++)this.actions[b].resetTransforms();else{var c=1;this.state==TimedAnimation.STATES.STOPPING&&this.stopMethod==TimedAnimation.STOP_METHODS.FADE&&(c=1-this.stoppingProgressTransition.getDrawValue());for(var a=this.actions.length,b=0;b<a;b++)this.actions[b].applyTransforms(c)}},Object.defineProperty(TimedAnimation.prototype,"delay",{get:function(){return this._delay},set:function(a){if(!Utils.isNumber(a))throw new TypeError("delay must be a number");this._delay=a}}),Object.defineProperty(TimedAnimation.prototype,"repeatDelay",{get:function(){return this._repeatDelay},set:function(a){if(!Utils.isNumber(a))throw new TypeError("repeatDelay must be a number");this._repeatDelay=a}}),Object.defineProperty(TimedAnimation.prototype,"duration",{get:function(){return this._duration},set:function(a){if(!Utils.isNumber(a))throw new TypeError("duration must be a number");this._duration=a}}),Object.defineProperty(TimedAnimation.prototype,"repeat",{get:function(){return this._repeat},set:function(a){if(!Utils.isInteger(a)||a<-1)throw new TypeError("repeat must be a positive integer, 0 or -1");this._repeat=a}}),Object.defineProperty(TimedAnimation.prototype,"repeatOffset",{get:function(){return this._repeatOffset},set:function(a){if(!Utils.isNumber(a)||a<0)throw new TypeError("repeatOffset must be a positive number");this._repeatOffset=a}}),Object.defineProperty(TimedAnimation.prototype,"stopMethod",{get:function(){return this._stopMethod},set:function(a){this._stopMethod=a}}),Object.defineProperty(TimedAnimation.prototype,"autostop",{get:function(){return this._autostop},
set:function(a){if(!Utils.isBoolean(a))throw new TypeError("autostop must be a boolean");this._autostop=a}}),Object.defineProperty(TimedAnimation.prototype,"stopMethodOptions",{get:function(){return this._stopMethodOptions},set:function(a){if(!Utils.isObject(a))throw new TypeError("stopMethodOptions must be an object");this._stopMethodOptions=a}}),Object.defineProperty(TimedAnimation.prototype,"subject",{get:function(){return this._subject},set:function(a){a!==this._subject&&(this._subject&&this._subject.removeTimedAnimation(this),a&&a.addTimedAnimation(this),this._subject=a,this.isActive()&&this.activate())}}),TimedAnimation.STATES={IDLE:0,PLAYING:1,STOPPING:2,STOPPED:3,FINISHED:4},TimedAnimation.STOP_METHODS={FADE:"fade",REVERSE:"reverse",FORWARD:"forward",IMMEDIATE:"immediate",ONETOTWO:"onetotwo"},Renderer.prototype.destroy=function(){this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteBuffer(this.paramsGlBuffer),this.gl.deleteBuffer(this.indicesGlBuffer),this.gl.deleteProgram(this.program)},Renderer.prototype.initShaderProgram=function(){var a=this.gl,b=this.glCompile(a.VERTEX_SHADER,this.vertexShaderSrc),c=this.glCompile(a.FRAGMENT_SHADER,this.fragmentShaderSrc);this.program=a.createProgram(),a.attachShader(this.program,b),a.attachShader(this.program,c),a.linkProgram(this.program),a.getProgramParameter(this.program,a.LINK_STATUS)||(console.error("Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",a.getProgramParameter(this.program,a.VALIDATE_STATUS)),console.error("gl.getError()",a.getError()),""!==a.getProgramInfoLog(this.program)&&console.warn("Warning: gl.getProgramInfoLog()",a.getProgramInfoLog(this.program)),a.deleteProgram(this.program),this.program=null),a.useProgram(this.program),a.deleteShader(b),a.deleteShader(c),this.vertexPositionAttribute=a.getAttribLocation(this.program,"aVertexPosition"),this.textureCoordAttribute=a.getAttribLocation(this.program,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(this.program,"aColor"),this.allIndices=new Uint16Array(1e5);for(var d=0,e=0;d<6*Renderer.MAX_QUADS;d+=6,e+=4)this.allIndices[d]=e,this.allIndices[d+1]=e+1,this.allIndices[d+2]=e+2,this.allIndices[d+3]=e,this.allIndices[d+4]=e+2,this.allIndices[d+5]=e+3;this.paramsGlBuffer=a.createBuffer(),this.indicesGlBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indicesGlBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.allIndices,a.STATIC_DRAW);var f=a.getUniformLocation(this.program,"projectionMatrix");a.uniformMatrix4fv(f,!1,this.projectionMatrix)},Renderer.prototype.render=function(){var a=this.gl;if(a.isContextLost&&a.isContextLost())return void console.error("WebGL context lost");this.renderItems()},Renderer.prototype.renderItems=function(){var a,b=this.gl,c=this.stage.adapter.getUComponentContext();this.stage.measureDetails&&this.stage.timeStart("setup"),b.useProgram(this.program),b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,this.w,this.h),b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA),b.enable(b.BLEND),b.disable(b.DEPTH_TEST),b.clearColor(this.stage.glClearColor[0],this.stage.glClearColor[1],this.stage.glClearColor[2],this.stage.glClearColor[3]),b.clear(b.COLOR_BUFFER_BIT),this.stage.measureDetails&&this.stage.timeEnd("setup"),this.stage.measureDetails&&this.stage.timeStart("buffer");var d=new DataView(c.getVboParamsBuffer(),0,4*c.getVboIndex());b.bindBuffer(b.ARRAY_BUFFER,this.paramsGlBuffer),b.bufferData(b.ARRAY_BUFFER,d,b.DYNAMIC_DRAW),this.stage.measureDetails&&this.stage.timeEnd("buffer");var e=c.getVboGlTextures(),f=c.getVboGlTextureRepeats(),g=c.getVboGlTexturesCount();if(this.stage.measureDetails&&this.stage.timeStart("renderGl"),g){b.bindBuffer(b.ARRAY_BUFFER,this.paramsGlBuffer),b.vertexAttribPointer(this.vertexPositionAttribute,2,b.FLOAT,!1,16,0),b.vertexAttribPointer(this.textureCoordAttribute,2,b.UNSIGNED_SHORT,!0,16,8),b.vertexAttribPointer(this.colorAttribute,4,b.UNSIGNED_BYTE,!0,16,12),b.enableVertexAttribArray(this.vertexPositionAttribute),b.enableVertexAttribArray(this.textureCoordAttribute),b.enableVertexAttribArray(this.colorAttribute),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indicesGlBuffer);var h=0;for(a=0;a<g;a++)b.bindTexture(b.TEXTURE_2D,e[a]),b.drawElements(b.TRIANGLES,6*f[a],b.UNSIGNED_SHORT,6*h*2),h+=f[a];b.disableVertexAttribArray(this.vertexPositionAttribute),b.disableVertexAttribArray(this.textureCoordAttribute),b.disableVertexAttribArray(this.colorAttribute)}this.stage.measureDetails&&this.stage.timeEnd("renderGl")},Renderer.prototype.glCompile=function(a,b){var c=this.gl.createShader(a);return this.gl.shaderSource(c,b),this.gl.compileShader(c),this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)?c:(console.log(this.gl.getShaderInfoLog(c)),null)},Renderer.MAX_QUADS=16384;var UComponent=function(a){this.ctx=a,this.parent=null,this.hasUpdates=!1,this.recalc=0,this.worldAlpha=1,this.updateTreeOrder=0,this.hasBorders=!1,this.hasChildren=!1,this.worldPx=this.localPx=0,this.worldPy=this.localPy=0,this.worldTa=this.localTa=1,this.worldTb=this.localTb=0,this.worldTc=this.localTc=0,this.worldTd=this.localTd=1,this.isComplex=!1,this.localAlpha=1,this.children=[],this.w=0,this.h=0,this.clipping=!1,this.clippingParent=null,this.clippingSquare=!1,this.clippingSquareMinX=0,this.clippingSquareMaxX=0,this.clippingSquareMinY=0,this.clippingSquareMaxY=0,this.clippingEmpty=!1,this.clippingNoEffect=!1,this.clippingArea=null,this.displayedTextureSource=null,this.colorUl=this.colorUr=this.colorBl=this.colorBr=4294967295,this.txCoordsUl=0,this.txCoordsUr=65535,this.txCoordsBr=4294967295,this.txCoordsBl=4294901760,this.ulx=0,this.uly=0,this.brx=1,this.bry=1,this.inTextureAtlas=!1,this.zIndex=0,this.forceZIndexContext=!1,this.zContextUsage=0,this.zParent=null,this.zIndexedChildren=[],this.zSort=!1,this.borderTop=null,this.borderBottom=null,this.borderLeft=null,this.borderRight=null,this.isBorder=!1,this.isRoot=!1};UComponent.prototype.setRecalc=function(a){if(this.recalc|=a,this.worldAlpha){this.ctx.staticStage=!1;var b=this;do{b.hasUpdates=!0}while((b=b.parent)&&!b.hasUpdates)}else this.hasUpdates=!0},UComponent.prototype.setRecalcForced=function(a,b){if(this.recalc|=a,this.worldAlpha||b){this.ctx.staticStage=!1;var c=this;do{c.hasUpdates=!0}while((c=c.parent)&&!c.hasUpdates)}else this.hasUpdates=!0},UComponent.prototype.setParent=function(a){if(a!==this.parent){var b=this.isZContext(),c=this.parent;this.parent=a,this.setRecalc(7),0===this.zIndex?this.setZParent(a):this.setZParent(a?a.findZContext():null),b!==this.isZContext()&&(this.isZContext()?this.enableZContext(c.findZContext()):this.disableZContext());var d=a?a.clipping?a:a.clippingParent:null;this.isBorder&&d===this.parent&&(d=d.clippingParent),d!==this.clippingParent&&this.setClippingParent(d)}},UComponent.prototype.insertChild=function(a,b){this.children.splice(a,0,b),this.hasChildren=!0,b.setParent(this)},UComponent.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,1),this.hasChildren=this.children.length>0,b.setParent(null)},UComponent.prototype.clearChildren=function(){for(var a=0,b=this.children.length;a<b;a++)this.children[a].setParent(null);this.children.splice(0),this.zIndexedChildren.splice(0),this.hasChildren=!1},UComponent.prototype.setLocalTransform=function(a,b,c,d){this.setRecalc(4),this.localTa=a,this.localTb=b,this.localTc=c,this.localTd=d,this.isComplex=0!=b||0!=c},UComponent.prototype.setLocalTranslate=function(a,b){this.setRecalc(2),this.localPx=a,this.localPy=b},UComponent.prototype.addLocalTranslate=function(a,b){this.setRecalc(2),this.localPx+=a,this.localPy+=b},UComponent.prototype.setLocalAlpha=function(a){this.setRecalcForced(1,this.parent&&this.parent.worldAlpha&&a),this.localAlpha=a},UComponent.prototype.setDimensions=function(a,b){this.w=a,this.h=b,this.setRecalc(2),this.updateBorderDimensions()},UComponent.prototype.updateBorderDimensions=function(){var a=0,b=0;null!==this.borderLeft&&(this.borderLeft.setDimensions(this.borderLeft.w,this.h),this.borderLeft.setLocalTranslate(-this.borderLeft.w,0),a=this.borderLeft.w),null!==this.borderRight&&(this.borderRight.setDimensions(this.borderRight.w,this.h),this.borderRight.setLocalTranslate(this.w,0),b=this.borderRight.w),null!==this.borderTop&&(this.borderTop.setDimensions(this.w+a+b,this.borderTop.h),this.borderTop.setLocalTranslate(0-a,-this.borderTop.h)),null!==this.borderBottom&&(this.borderBottom.setDimensions(this.w+a+b,this.borderBottom.h),this.borderBottom.setLocalTranslate(0-a,this.h))},UComponent.prototype.setTextureCoords=function(a,b,c,d){this.worldAlpha&&(this.ctx.staticStage=!1),this.ulx=a,this.uly=b,this.brx=c,this.bry=d,this.txCoordsUl=(65535*a+.5|0)+65536*(65535*b+.5|0),this.txCoordsUr=(65535*c+.5|0)+65536*(65535*b+.5|0),this.txCoordsBl=(65535*a+.5|0)+65536*(65535*d+.5|0),this.txCoordsBr=(65535*c+.5|0)+65536*(65535*d+.5|0)},UComponent.prototype.setDisplayedTextureSource=function(a){this.worldAlpha&&(this.ctx.staticStage=!1),this.displayedTextureSource=a},UComponent.prototype.setInTextureAtlas=function(a){this.worldAlpha&&(this.ctx.staticStage=!1),this.inTextureAtlas=a},UComponent.prototype.setAsRoot=function(){this.parent=new UComponent,this.isRoot=!0,this.ctx.root=this},UComponent.prototype.isAncestorOf=function(a){for(var b=a;b=b.parent;)if(this===b)return!0;return!1},UComponent.prototype.isZContext=function(){return this.forceZIndexContext||0!==this.zIndex||this.isRoot||!this.parent},UComponent.prototype.findZContext=function(){return this.isZContext()?this:this.parent.findZContext()},UComponent.prototype.setZParent=function(a){if(this.zParent!==a){if(null!==this.zParent&&(0!==this.zIndex&&this.zParent.decZContextUsage(),this.zParent.zContextUsage>0)){var b=this.zParent.zIndexedChildren.indexOf(this);this.zParent.zIndexedChildren.splice(b,1)}null!==a&&(0!==this.zIndex&&a.incZContextUsage(),a.zContextUsage>0&&(a.zIndexedChildren.push(this),a.zSort=!0)),this.zParent=a}},UComponent.prototype.incZContextUsage=function(){if(1===++this.zContextUsage)for(var a=0,b=this.children.length;a<b;a++)this.zIndexedChildren.push(this.children[a])},UComponent.prototype.decZContextUsage=function(){0===--this.zContextUsage&&(this.zSort=!1,this.zIndexedChildren.splice(0))},UComponent.prototype.setZIndex=function(a){this.worldAlpha&&(this.ctx.staticStage=!1);var b=this.zParent,c=this.isZContext();0===a&&0!==this.zIndex?this.parent===this.zParent?this.zParent.decZContextUsage():b=this.parent:0!==a&&0===this.zIndex?(b=this.parent?this.parent.findZContext():null)===this.zParent&&this.zParent&&(this.zParent.incZContextUsage(),this.zParent.zSort=!0):a!==this.zIndex&&(this.zParent.zSort=!0),b!==this.zParent&&this.setZParent(null),this.zIndex=a,b!==this.zParent&&this.setZParent(b),c!==this.isZContext()&&(this.isZContext()?this.enableZContext(this.parent.findZContext()):this.disableZContext())},UComponent.prototype.setForceZIndexContext=function(a){this.worldAlpha&&(this.ctx.staticStage=!1);var b=this.isZContext();this.forceZIndexContext=a,b!==this.isZContext()&&(this.isZContext()?this.enableZContext(this.parent.findZContext()):this.disableZContext())},UComponent.prototype.enableZContext=function(a){if(a.zContextUsage>0){var b=this;a.zIndexedChildren.slice().forEach(function(a){b.isAncestorOf(a)&&0!==a.zIndex&&a.setZParent(b)})}},UComponent.prototype.disableZContext=function(){if(this.zContextUsage>0){var a=this.parent.findZContext();this.zIndexedChildren.slice().forEach(function(b){0!==b.zIndex&&b.setZParent(a)})}},UComponent.prototype.setClipping=function(a){a!==this.clipping&&(this.setRecalc(8),this.clipping=a,this.setChildrenClippingParent(a?this:this.clippingParent))},UComponent.prototype.setChildrenClippingParent=function(a){for(var b=0,c=this.children.length;b<c;b++)this.children[b].setClippingParent(a)},UComponent.prototype.setClippingParent=function(a){if(this.clippingParent!==a){if(this.setRecalc(8),this.clippingParent=a,!this.clipping)for(var b=0,c=this.children.length;b<c;b++)this.children[b].setClippingParent(a);this.hasBorders&&(this.borderTop&&this.borderTop.setClippingParent(a),this.borderBottom&&this.borderBottom.setClippingParent(a),this.borderLeft&&this.borderLeft.setClippingParent(a),this.borderRight&&this.borderRight.setClippingParent(a))}},UComponent.prototype.setColorUl=function(a){this.worldAlpha&&(this.ctx.staticStage=!1),this.colorUl=a},UComponent.prototype.setColorUr=function(a){this.worldAlpha&&(this.ctx.staticStage=!1),this.colorUr=a},UComponent.prototype.setColorBl=function(a){this.worldAlpha&&(this.ctx.staticStage=!1),this.colorBl=a},UComponent.prototype.setColorBr=function(a){this.worldAlpha&&(this.ctx.staticStage=!1),this.colorBr=a},UComponent.prototype.setBorderTop=function(a,b){this.worldAlpha&&(this.ctx.staticStage=!1),null===this.borderTop&&(this.borderTop=this.ctx.createUComponent(),this.borderTop.isBorder=!0,this.borderTop.setParent(this),this.borderTop.displayedTextureSource=this.ctx.rectangleTextureSource,this.borderTop.setTextureCoords(0,0,0,0)),this.borderTop.setDimensions(this.w,a),this.borderTop.setLocalTranslate(0,-a),this.borderTop.colorUl=b,this.borderTop.colorUr=b,this.borderTop.colorBr=b,this.borderTop.colorBl=b,this.updateBorderDimensions(),this.updateHasBorders()},UComponent.prototype.setBorderBottom=function(a,b){this.worldAlpha&&(this.ctx.staticStage=!1),null===this.borderBottom&&(this.borderBottom=this.ctx.createUComponent(),this.borderBottom.isBorder=!0,this.borderBottom.setParent(this),this.borderBottom.displayedTextureSource=this.ctx.rectangleTextureSource,this.borderBottom.setTextureCoords(0,0,0,0)),this.borderBottom.setDimensions(this.w,a),this.borderBottom.setLocalTranslate(0,this.h),this.borderBottom.colorUl=b,this.borderBottom.colorUr=b,this.borderBottom.colorBr=b,this.borderBottom.colorBl=b,this.updateBorderDimensions(),this.updateHasBorders()},UComponent.prototype.setBorderLeft=function(a,b){this.worldAlpha&&(this.ctx.staticStage=!1),null===this.borderLeft&&(this.borderLeft=this.ctx.createUComponent(),this.borderLeft.isBorder=!0,this.borderLeft.setParent(this),this.borderLeft.displayedTextureSource=this.ctx.rectangleTextureSource,this.borderLeft.setTextureCoords(0,0,0,0)),this.borderLeft.setDimensions(a,this.h),this.borderLeft.setLocalTranslate(-a,0),this.borderLeft.colorUl=b,this.borderLeft.colorUr=b,this.borderLeft.colorBr=b,this.borderLeft.colorBl=b,this.updateBorderDimensions(),this.updateHasBorders()},UComponent.prototype.setBorderRight=function(a,b){this.worldAlpha&&(this.ctx.staticStage=!1),null===this.borderRight&&(this.borderRight=this.ctx.createUComponent(),this.borderRight.isBorder=!0,this.borderRight.setParent(this),this.borderRight.displayedTextureSource=this.ctx.rectangleTextureSource,this.borderRight.setTextureCoords(0,0,0,0)),this.borderRight.setDimensions(a,this.h),this.borderRight.setLocalTranslate(this.w,0),this.borderRight.colorUl=b,this.borderRight.colorUr=b,this.borderRight.colorBr=b,this.borderRight.colorBl=b,this.updateBorderDimensions(),this.updateHasBorders()},UComponent.prototype.updateHasBorders=function(){this.hasBorders=null!==this.borderTop&&this.borderTop.h||null!==this.borderBottom&&this.borderBottom.h||null!==this.borderLeft&&this.borderLeft.w||null!==this.borderRight&&this.borderRight.w},UComponent.prototype.update=function(){this.recalc|=this.parent.recalc;var a=!1;if(1&this.recalc&&(a=this.worldAlpha&&!(this.parent.worldAlpha&&this.localAlpha),this.worldAlpha=this.parent.worldAlpha*this.localAlpha,this.worldAlpha<1e-14&&this.worldAlpha>-1e-14&&(this.worldAlpha=0)),this.worldAlpha||a){if(6&this.recalc&&(this.worldPx=this.parent.worldPx+this.localPx*this.parent.worldTa,this.worldPy=this.parent.worldPy+this.localPy*this.parent.worldTd),4&this.recalc&&(this.worldTa=this.localTa*this.parent.worldTa,this.worldTb=this.localTd*this.parent.worldTb,this.worldTc=this.localTa*this.parent.worldTc,this.worldTd=this.localTd*this.parent.worldTd,this.isComplex&&(this.worldTa+=this.localTc*this.parent.worldTb,this.worldTb+=this.localTb*this.parent.worldTa,this.worldTc+=this.localTc*this.parent.worldTd,this.worldTd+=this.localTb*this.parent.worldTc)),6&this.recalc&&(0!==this.parent.worldTb||0!==this.parent.worldTc)&&(this.worldPx+=this.localPy*this.parent.worldTb,this.worldPy+=this.localPx*this.parent.worldTc),14&this.recalc&&(this.clippingParent||this.clipping)){var b,c,d,e,f,g,h=this.clippingParent;if(h&&h.clippingEmpty)this.clippingEmpty=!0,this.clippingArea=null,this.clippingNoEffect=!1;else if(this.clippingNoEffect=!1,this.clippingEmpty=!1,this.clippingArea=null,h)if(h.clippingSquare&&0===this.worldTb&&0===this.worldTc&&this.worldTa>0&&this.worldTd>0)this.clippingSquare=!0,d=this.worldPx+this.w*this.worldTa,e=this.worldPy+this.h*this.worldTd,this.clippingSquareMinX=this.worldPx,this.clippingSquareMaxX=d,this.clippingSquareMinY=this.worldPy,this.clippingSquareMaxY=e,this.clippingSquareMinX>=h.clippingSquareMinX&&this.clippingSquareMaxX<=h.clippingSquareMaxX&&this.clippingSquareMinY>=h.clippingSquareMinY&&this.clippingSquareMaxY<=h.clippingSquareMaxY?(this.clippingNoEffect=!0,this.clipping&&(this.clippingSquareMinX=this.worldPx,this.clippingSquareMaxX=d,this.clippingSquareMinY=this.worldPy,this.clippingSquareMaxY=e)):(this.clippingSquareMinX=Math.max(this.clippingSquareMinX,h.clippingSquareMinX),this.clippingSquareMaxX=Math.min(this.clippingSquareMaxX,h.clippingSquareMaxX),this.clippingSquareMinY=Math.max(this.clippingSquareMinY,h.clippingSquareMinY),this.clippingSquareMaxY=Math.min(this.clippingSquareMaxY,h.clippingSquareMaxY),(this.clippingSquareMaxX<this.clippingSquareMinX||this.clippingSquareMaxY<this.clippingSquareMinY)&&(this.clippingEmpty=!0));else{b=this.worldPx+this.w*this.worldTa,c=this.worldPy+this.w*this.worldTc,d=this.worldPx+this.w*this.worldTa+this.h*this.worldTb,e=this.worldPy+this.w*this.worldTc+this.h*this.worldTd,f=this.worldPx+this.h*this.worldTb,g=this.worldPy+this.h*this.worldTd,this.clippingSquare=!1;var i=[this.worldPx,this.worldPy,b,c,d,e,f,g];h.clippingSquare&&!h.clippingArea&&(h.clippingArea=[h.clippingSquareMinX,h.clippingSquareMinY,h.clippingSquareMaxX,h.clippingSquareMinY,h.clippingSquareMaxX,h.clippingSquareMaxY,h.clippingSquareMinX,h.clippingSquareMaxY]),this.clippingArea=GeometryUtils.intersectConvex(h.clippingArea,i),this.clippingEmpty=0===this.clippingArea.length,this.clippingNoEffect=i===this.clippingArea}else b=this.worldPx+this.w*this.worldTa,g=this.worldPy+this.h*this.worldTd,0===this.worldTb&&0===this.worldTc&&this.worldTa>0&&this.worldTd>0?(this.clippingSquare=!0,this.clipping&&(this.clippingSquareMinX=this.worldPx,this.clippingSquareMaxX=b,this.clippingSquareMinY=this.worldPy,this.clippingSquareMaxY=g),this.clippingEmpty=!1,this.clippingNoEffect=!0):(c=this.worldPy+this.w*this.worldTc,d=this.worldPx+this.w*this.worldTa+this.h*this.worldTb,e=this.worldPy+this.w*this.worldTc+this.h*this.worldTd,f=this.worldPx+this.h*this.worldTb,this.clippingSquare=!1,this.clipping&&(this.clippingArea=[this.worldPx,this.worldPy,b,c,d,e,f,g]),this.clippingEmpty=!1,this.clippingNoEffect=!0)}if(this.ctx.useZIndexing?this.updateTreeOrder=this.ctx.updateTreeOrder++:this.displayedTextureSource&&this.addToVbo(),this.hasUpdates=!1,this.recalc=7&this.recalc,this.hasBorders&&(null!==this.borderTop&&this.borderTop.h&&this.borderTop.update(),null!==this.borderBottom&&this.borderBottom.h&&this.borderBottom.update(),null!==this.borderLeft&&this.borderLeft.w&&this.borderLeft.update(),null!==this.borderRight&&this.borderRight.w&&this.borderRight.update()),this.hasChildren)for(var j=0,k=this.children.length;j<k;j++)this.recalc||this.children[j].hasUpdates?this.children[j].update():this.ctx.useZIndexing||this.children[j].fillVbo();this.recalc=0}},UComponent.prototype.sortZIndexedChildren=function(){for(var a=1,b=this.zIndexedChildren.length;a<b;a++){for(var c=this.zIndexedChildren[a],d=a-1;d>=0;){var e=this.zIndexedChildren[d];if(!(c.zIndex===e.zIndex?c.updateTreeOrder<e.updateTreeOrder:c.zIndex<e.zIndex))break;this.zIndexedChildren[d+1]=this.zIndexedChildren[d],d--}this.zIndexedChildren[d+1]=c}},UComponent.prototype.addToVbo=function(){var a=this.ctx.vboIndex,b=this.ctx.vboBufferFloat,c=this.ctx.vboBufferUint;if(this.clippingParent&&!this.clippingNoEffect)this.clippingEmpty||this.addToVboClipped();else if(0!==this.worldTb||0!==this.worldTc)a<262144&&(b[a++]=this.worldPx,b[a++]=this.worldPy,c[a++]=this.txCoordsUl,c[a++]=getColorInt(this.colorUl,this.worldAlpha),b[a++]=this.worldPx+this.w*this.worldTa,b[a++]=this.worldPy+this.w*this.worldTc,c[a++]=this.txCoordsUr,c[a++]=getColorInt(this.colorUr,this.worldAlpha),b[a++]=this.worldPx+this.w*this.worldTa+this.h*this.worldTb,b[a++]=this.worldPy+this.w*this.worldTc+this.h*this.worldTd,c[a++]=this.txCoordsBr,c[a++]=getColorInt(this.colorBr,this.worldAlpha),b[a++]=this.worldPx+this.h*this.worldTb,b[a++]=this.worldPy+this.h*this.worldTd,c[a++]=this.txCoordsBl,c[a++]=getColorInt(this.colorBl,this.worldAlpha),this.ctx.addVboTextureSource(this,1));else{var d=this.worldPx+this.w*this.worldTa,e=this.worldPy+this.h*this.worldTd;a<262144&&(b[a++]=this.worldPx,b[a++]=this.worldPy,c[a++]=this.txCoordsUl,c[a++]=getColorInt(this.colorUl,this.worldAlpha),b[a++]=d,b[a++]=this.worldPy,c[a++]=this.txCoordsUr,c[a++]=getColorInt(this.colorUr,this.worldAlpha),b[a++]=d,b[a++]=e,c[a++]=this.txCoordsBr,c[a++]=getColorInt(this.colorBr,this.worldAlpha),b[a++]=this.worldPx,b[a++]=e,c[a++]=this.txCoordsBl,c[a++]=getColorInt(this.colorBl,this.worldAlpha),this.ctx.addVboTextureSource(this,1))}},UComponent.prototype.addToVboClipped=function(){var a=this.ctx.vboIndex,b=this.ctx.vboBufferFloat,c=this.ctx.vboBufferUint,d=getColorInt(this.colorUl,this.worldAlpha);if(this.clippingSquare){var e=this.w*this.worldTa,f=this.h*this.worldTd,g=1/(e*f),h=f*g,i=e*g,j=h*(this.clippingSquareMinX-this.worldPx),k=i*(this.clippingSquareMinY-this.worldPy),l=h*(this.clippingSquareMaxX-this.worldPx),m=i*(this.clippingSquareMaxY-this.worldPy),n=this.ulx*(1-j)+this.brx*j,o=this.uly*(1-k)+this.bry*k,p=this.ulx*(1-l)+this.brx*l,q=this.uly*(1-m)+this.bry*m;a<262144&&(b[a++]=this.clippingSquareMinX,b[a++]=this.clippingSquareMinY,c[a++]=getVboTextureCoords(n,o),c[a++]=d,b[a++]=this.clippingSquareMaxX,b[a++]=this.clippingSquareMinY,c[a++]=getVboTextureCoords(p,o),c[a++]=d,b[a++]=this.clippingSquareMaxX,b[a++]=this.clippingSquareMaxY,c[a++]=getVboTextureCoords(p,q),c[a++]=d,b[a++]=this.clippingSquareMinX,b[a++]=this.clippingSquareMaxY,c[a++]=getVboTextureCoords(n,q),c[a++]=d,this.ctx.addVboTextureSource(this,1))}else{e=this.w*this.worldTa;var r=this.w*this.worldTc,s=this.h*this.worldTb;f=this.h*this.worldTd,g=1/(e*f-s*r),h=f*g;var t=-s*g,u=-r*g;i=e*g;var v=Math.ceil((this.clippingArea.length/2-2)/2);if(1===v){j=h*(this.clippingArea[0]-this.worldPx)+t*(this.clippingArea[1]-this.worldPy),k=u*(this.clippingArea[0]-this.worldPx)+i*(this.clippingArea[1]-this.worldPy);var w=h*(this.clippingArea[2]-this.worldPx)+t*(this.clippingArea[3]-this.worldPy),x=u*(this.clippingArea[2]-this.worldPx)+i*(this.clippingArea[3]-this.worldPy);l=h*(this.clippingArea[4]-this.worldPx)+t*(this.clippingArea[5]-this.worldPy),m=u*(this.clippingArea[4]-this.worldPx)+i*(this.clippingArea[5]-this.worldPy),A=this.clippingArea.length<=6?4:6;var y=h*(this.clippingArea[A]-this.worldPx)+t*(this.clippingArea[A+1]-this.worldPy),z=u*(this.clippingArea[A]-this.worldPx)+i*(this.clippingArea[A+1]-this.worldPy);a<262144&&(b[a++]=this.clippingArea[0],b[a++]=this.clippingArea[1],c[a++]=getVboTextureCoords(this.ulx*(1-j)+this.brx*j,this.uly*(1-k)+this.bry*k),c[a++]=d,b[a++]=this.clippingArea[2],b[a++]=this.clippingArea[3],c[a++]=getVboTextureCoords(this.ulx*(1-w)+this.brx*w,this.uly*(1-x)+this.bry*x),c[a++]=d,b[a++]=this.clippingArea[4],b[a++]=this.clippingArea[5],c[a++]=getVboTextureCoords(this.ulx*(1-l)+this.brx*l,this.uly*(1-m)+this.bry*m),c[a++]=d,b[a++]=this.clippingArea[A],b[a++]=this.clippingArea[A+1],c[a++]=getVboTextureCoords(this.ulx*(1-y)+this.brx*y,this.uly*(1-z)+this.bry*z),c[a++]=d,this.ctx.addVboTextureSource(this,1))}else for(var A,B=0;B<v;B++){var C=4*B+2;A=C+4,A>=this.clippingArea.length&&(A-=2),j=h*(this.clippingArea[0]-this.worldPx)+t*(this.clippingArea[1]-this.worldPy),k=u*(this.clippingArea[0]-this.worldPx)+i*(this.clippingArea[1]-this.worldPy),w=h*(this.clippingArea[C]-this.worldPx)+t*(this.clippingArea[C+1]-this.worldPy),x=u*(this.clippingArea[C]-this.worldPx)+i*(this.clippingArea[C+1]-this.worldPy),l=h*(this.clippingArea[C+2]-this.worldPx)+t*(this.clippingArea[C+3]-this.worldPy),m=u*(this.clippingArea[C+2]-this.worldPx)+i*(this.clippingArea[C+3]-this.worldPy),y=h*(this.clippingArea[A]-this.worldPx)+t*(this.clippingArea[A+1]-this.worldPy),z=u*(this.clippingArea[A]-this.worldPx)+i*(this.clippingArea[A+1]-this.worldPy),a<262144&&(b[a++]=this.clippingArea[0],b[a++]=this.clippingArea[1],c[a++]=getVboTextureCoords(this.ulx*(1-j)+this.brx*j,this.uly*(1-k)+this.bry*k),c[a++]=d,b[a++]=this.clippingArea[C],b[a++]=this.clippingArea[C+1],c[a++]=getVboTextureCoords(this.ulx*(1-w)+this.brx*w,this.uly*(1-x)+this.bry*x),c[a++]=d,b[a++]=this.clippingArea[C+2],b[a++]=this.clippingArea[C+3],c[a++]=getVboTextureCoords(this.ulx*(1-l)+this.brx*l,this.uly*(1-m)+this.bry*m),c[a++]=d,b[a++]=this.clippingArea[A],b[a++]=this.clippingArea[A+1],c[a++]=getVboTextureCoords(this.ulx*(1-y)+this.brx*y,this.uly*(1-z)+this.bry*z),c[a++]=d,this.ctx.addVboTextureSource(this,1))}}},UComponent.prototype.fillVbo=function(){if(this.zSort&&(this.sortZIndexedChildren(),this.zSort=!1),this.worldAlpha&&(this.displayedTextureSource&&this.addToVbo(),this.hasBorders&&(null!==this.borderTop&&this.borderTop.h&&this.borderTop.addToVbo(),null!==this.borderBottom&&this.borderBottom.h&&this.borderBottom.addToVbo(),null!==this.borderLeft&&this.borderLeft.w&&this.borderLeft.addToVbo(),null!==this.borderRight&&this.borderRight.w&&this.borderRight.addToVbo()),this.hasChildren))if(this.zContextUsage)for(var a=0,b=this.zIndexedChildren.length;a<b;a++)this.zIndexedChildren[a].fillVbo();else for(var a=0,b=this.children.length;a<b;a++)this.children[a].fillVbo()},UComponent.prototype.getLocalTa=function(){return this.localTa},UComponent.prototype.getLocalTb=function(){return this.localTb},UComponent.prototype.getLocalTc=function(){return this.localTc},UComponent.prototype.getLocalTd=function(){return this.localTd},UComponent.prototype.getCornerPoints=function(){return[this.worldPx,this.worldPy,this.worldPx+this.w*this.worldTa,this.worldPy+this.w*this.worldTc,this.worldPx+this.w*this.worldTa+this.h*this.worldTb,this.worldPy+this.w*this.worldTc+this.h*this.worldTd,this.worldPx+this.h*this.worldTb,this.worldPy+this.h*this.worldTd]};var getColorInt=function(a,b){var c=(a/16777216|0)*b|0;return((a>>16&255)*c>>8&255)+((65280&a)*c>>8&65280)+(((255&a)<<16)*c>>8&16711680)+(c<<24)},getVboTextureCoords=function(a,b){return(65535*a+.5|0)+65536*(65535*b+.5|0)},UComponentContext=function(){this.vboGlTextures=[],this.vboGlTextureRepeats=[],this.lastVboGlTexture=null,this.textureAtlasGlTexture=null,this.rectangleTextureSource=null,this.rectangleTextureSourceInTextureAtlas=!1,this.vboParamsBuffer=new ArrayBuffer(2097152),this.vboBufferFloat=new Float32Array(this.vboParamsBuffer),this.vboBufferUint=new Uint32Array(this.vboParamsBuffer),this.vboIndex=0,this.n=0,this.useZIndexing=!1,this.root=null,this.updateTreeOrder=0,this.staticStage=!1,this.debugTextureAtlas=null};UComponentContext.prototype.setStage=function(a){if(this.textureAtlasGlTexture=a.textureAtlas?a.textureAtlas.texture:null,this.rectangleTextureSource=a.getRectangleTexture().source,a.debugTextureAtlas){this.debugTextureAtlas=this.createUComponent(),this.debugTextureAtlas.displayedTextureSource=this.rectangleTextureSource,this.debugTextureAtlas.setInTextureAtlas(!0);var b=Math.min(a.w,a.h);this.debugTextureAtlas.setDimensions(b,b)}},UComponentContext.prototype.createUComponentForComponent=function(a){return new UComponent(this)},UComponentContext.prototype.createUComponent=function(){return new UComponent(this)},UComponentContext.prototype.setDisplayedTextureSource=function(a,b){a.setDisplayedTextureSource(b)},UComponentContext.prototype.reset=function(){this.vboIndex=0,this.vboGlTextures=[],this.vboGlTextureRepeats=[],this.lastVboGlTexture=null,this.rectangleTextureSourceInTextureAtlas=this.rectangleTextureSource.inTextureAtlas,this.n=0,this.updateTreeOrder=0},UComponentContext.prototype.addVboTextureSource=function(a,b){var c;c=a.isBorder?this.rectangleTextureSourceInTextureAtlas?this.textureAtlasGlTexture:this.rectangleTextureSource.glTexture:a.inTextureAtlas?this.textureAtlasGlTexture:a.displayedTextureSource.glTexture,this.lastVboGlTexture!==c?(this.vboGlTextures.push(c),this.vboGlTextureRepeats.push(b),this.n++,this.lastVboGlTexture=c):this.vboGlTextureRepeats[this.n-1]+=b,this.vboIndex+=16*b},UComponentContext.prototype.getVboIndex=function(){return this.vboIndex},UComponentContext.prototype.getVboParamsBuffer=function(){return this.vboParamsBuffer},UComponentContext.prototype.getVboGlTextures=function(){return this.vboGlTextures},UComponentContext.prototype.getVboGlTextureRepeats=function(){return this.vboGlTextureRepeats},UComponentContext.prototype.getVboGlTexturesCount=function(){return this.vboGlTextures.length},UComponentContext.prototype.updateAndFillVbo=function(a){var b=!this.staticStage;return this.staticStage||(this.useZIndexing=a,this.reset(),this.root.update(),this.useZIndexing&&this.root.fillVbo(),this.debugTextureAtlas&&this.debugTextureAtlas.addToVbo(),this.staticStage=!0),b},Object.defineProperty(UComponentContext.prototype,"staticStage",{get:function(){return this._staticStage},set:function(a){this._staticStage=a}}),{}.getRoundRect=function(a,b,c,d,e,f,g,h){void 0===g&&(g=!0),void 0===e&&(e=0);var i=a.adapter.getDrawingCanvas(),j=i.getContext("2d");j.imageSmoothingEnabled=!0;var k="rect"+[b,c,d,e,f,g?1:0,h].join(",");return a.getTexture(function(a){i.width=b+e+2,i.height=c+e+2,j.beginPath();var k=.5*e+1,l=.5*e+1;j.moveTo(k+d,l),j.lineTo(k+b-d,l),j.arcTo(k+b,l,k+b,l+d,d),j.lineTo(k+b,l+c-d),j.arcTo(k+b,l+c,k+b-d,l+c,d),j.lineTo(k+d,l+c),j.arcTo(k,l+c,k,l+c-d,d),j.lineTo(k,l+d),j.arcTo(k,l,k+d,l,d),g&&(Utils.isNumber(h)&&(h="#"+h.toString(16)),j.fillStyle=h||"white",j.fill()),e&&(Utils.isNumber(f)&&(f="#"+f.toString(16)),j.strokeStyle=f||"white",j.lineWidth=e,j.stroke()),a(i,{})},{id:k})},Utils.extendClass(List,EventEmitter),List.prototype.setProgressAnimation=function(a){a?(this._progressAnimation||(this._progressAnimation=new Animation(this.stage)),this._progressAnimation.set(a)):this._progressAnimation=null},List.prototype.getElementsCount=function(){return this.wrapper.children.length},List.prototype.getViewportSize=function(){return this.horizontal?this.component.W:this.component.H},List.prototype.update=function(){if(this.wrapper.children.length){var a=this.horizontal^this.invertDirection?-1:1,b=this.horizontal?this.wrapper.X:this.wrapper.Y,c=this.getViewportSize(),d=this.viewportScrollOffset*c-this.itemScrollOffset*this.itemSize;if((b+=d)!==this.prevValue||c!==this.prevViewportSize||this.reloadVisibleElements){this.prevValue=b,this.prevViewportSize=c;var e,f,g,h;a==-1?(e=Math.floor(-b/this.itemSize),g=1-(-b/this.itemSize-e),f=Math.floor((c-b)/this.itemSize),h=(c-b)/this.itemSize-f):(e=Math.ceil(b/this.itemSize),g=1+b/this.itemSize-e,f=Math.ceil((b-c)/this.itemSize),h=f-(b-c)/this.itemSize);var i=this.wrapper.children.length;(this.wrap||c>this.itemSize*i)&&(f>=i&&(f=i-1),e>=i&&(e=i-1),f<=-1&&(f=0),e<=-1&&(e=0));for(var j,k=-a*e*this.itemSize,l=e;a==-1?l<=f:l>=f;a==-1?l++:l--){var m=Utils.getArrayIndex(l,this.wrapper.children);if(j=this.wrapper.children[m],this.visibleItems.delete(j),this.horizontal?j.x=k+d:j.y=k+d,j.visible&&!this.reloadVisibleElements||this.emit("elementVisible",j,m),j.visible=!0,this._progressAnimation){var n=1;l==e?n=g:l==f&&(n=h),this._progressAnimation.subject=j,this._progressAnimation.p=n,this._progressAnimation.applyTransforms()}k+=this.itemSize}var o=this;for(this.visibleItems.forEach(function(a){a.visible=!1,o.visibleItems.delete(a)}),
l=e;a==-1?l<=f:l>=f;a==-1?l++:l--)m=Utils.getArrayIndex(l,this.wrapper.children),j=this.wrapper.children[m],this.visibleItems.add(j);this.reloadVisibleElements=!1}}},List.prototype.setup=function(){var a=this,b=function(){a.update()};this.component.notifyActivate=function(){a.stage.on("update",b)},this.component.notifyDeactivate=function(){a.stage.off("update",b)}},List.prototype.clearElements=function(){this.wrapper.removeChildren(),this.reloadVisibleElements=!0},List.prototype.addElement=function(a){var b=this.stage.c({visible:!1});return b.addChild(a),this.wrapper.addChild(b),this.reloadVisibleElements=!0,b},List.prototype.removeElementAt=function(a){var b=this.getRealIndex();this.wrapper.removeChildAt(a),b===a?(b===this.wrapper.children.length&&b--,b>=0&&this.setIndex(b)):b>a&&this.setIndex(b-1),this.reloadVisibleElements=!0},List.prototype.setIndex=function(a,b,c){var d=this.wrapper.children.length;if(d){if(this.emit("elementDeselected",this.index,this.getRealIndex()),this.rollOver)if(c){var e=Utils.getArrayIndex(a,this.wrapper.children),f=Utils.getArrayIndex(this.index,this.wrapper.children),g=e-f;g>.5*d?g-=d:g<-.5*d&&(g+=d),this.index+=g}else this.index=a;else this.index<0&&(this.index=0),this.index>=d&&(this.index=d-1),this.index=a;(this.wrap||this.getViewportSize()>this.itemSize*d)&&(this.index=Utils.getArrayIndex(this.index,this.wrapper.children));var h=this.horizontal^this.invertDirection?-1:1,i=h*this.index*this.itemSize;if(this.wrap){var j,k,l;if(1==h)k=(d-1)*this.itemSize,l=this.viewportScrollOffset*this.getViewportSize()-this.itemScrollOffset*this.itemSize,k-=l,j=this.getViewportSize()-(this.itemSize+l),this.wrapMin&&(j-=this.wrapMin),this.wrapMax&&(k+=this.wrapMax),i=Math.max(Math.min(i,k),j);else{k=d*this.itemSize-this.getViewportSize(),l=this.viewportScrollOffset*this.getViewportSize()-this.itemScrollOffset*this.itemSize,k+=l;var j=l;this.wrapMin&&(j-=this.wrapMin),this.wrapMax&&(k+=this.wrapMax),i=Math.min(Math.max(-k,i),-j)}}this.wrapper[this.horizontal?"x":"y"]=i,b&&this.scrollTransition.reset(i,i,1),this.emit("elementSelected",this.index,this.getRealIndex())}},List.prototype.setPrevious=function(){this.setIndex(this.index-1)},List.prototype.setNext=function(){this.setIndex(this.index+1)},List.prototype.getRealIndex=function(){return Utils.getArrayIndex(this.index,this.wrapper.children)},List.prototype.getIndexItem=function(){return this.wrapper.children[this.getRealIndex()]},List.prototype.getIndexElement=function(){return this.wrapper.children[this.getRealIndex()].children[0]},List.prototype.getElement=function(a){var b=this.wrapper.children[a];return b?b.children[0]:null},List.prototype.reload=function(){this.reloadVisibleElements=!0},List.prototype.set=function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=b[c],e=a[d];this.setSetting(d,e)}},List.prototype.setSetting=function(a,b){if(void 0===this[a])throw new TypeError("Unknown property:"+a);this[a]=b},Object.defineProperty(List.prototype,"itemSize",{get:function(){return this._itemSize},set:function(a){if(!Utils.isNumber(a))throw new TypeError("Not a number");this._itemSize!==a&&(this._itemSize=a,this.prevValue=null)}}),Object.defineProperty(List.prototype,"viewportScrollOffset",{get:function(){return this._viewportScrollOffset},set:function(a){if(!Utils.isNumber(a))throw new TypeError("Not a number");this._viewportScrollOffset!==a&&(this._viewportScrollOffset=a,this.prevValue=null)}}),Object.defineProperty(List.prototype,"itemScrollOffset",{get:function(){return this._itemScrollOffset},set:function(a){if(!Utils.isNumber(a))throw new TypeError("Not a number");this._itemScrollOffset!==a&&(this._itemScrollOffset=a,this.prevValue=null)}}),Object.defineProperty(List.prototype,"rollOver",{get:function(){return this._rollOver},set:function(a){if(!Utils.isBoolean(a))throw new TypeError("Not a boolean");this._rollOver!==a&&(this._rollOver=a,this.prevValue=null)}}),Object.defineProperty(List.prototype,"wrap",{get:function(){return this._wrap},set:function(a){if(!Utils.isBoolean(a))throw new TypeError("Not a boolean");this._wrap!==a&&(this._wrap=a,this.prevValue=null)}}),Object.defineProperty(List.prototype,"index",{get:function(){return this._index},set:function(a){if(!Utils.isInteger(a))throw new TypeError("Not a number");this._index!==a&&(this._index=a)}}),Object.defineProperty(List.prototype,"invertDirection",{get:function(){return this._invertDirection},set:function(a){if(!Utils.isBoolean(a))throw new TypeError("Not a boolean");this._invertDirection!==a&&(this._invertDirection=a,this.prevValue=null)}}),Object.defineProperty(List.prototype,"wrapMin",{get:function(){return this._wrapMin},set:function(a){if(!Utils.isNumber(a))throw new TypeError("Not a number");this._wrapMin!==a&&(this._wrapMin=a,this.prevValue=null)}}),Object.defineProperty(List.prototype,"wrapMax",{get:function(){return this._wrapMax},set:function(a){if(!Utils.isNumber(a))throw new TypeError("Not a number");this._wrapMax!==a&&(this._wrapMax=a,this.prevValue=null)}});var WebAdapter=function(){this.animationFunction=function(){},this.animationLoopStopped=!1,this.canvas=null,this.uComponentContext=new UComponentContext,this.glClearColor=[0,0,0,0]};WebAdapter.prototype.init=function(){this.uComponentContext.setStage(this.stage)},WebAdapter.prototype.startAnimationLoop=function(a){this.animationFunction=a||this.animationFunction,this.animationLoopStopped=!1,this.loop()},WebAdapter.prototype.stopAnimationLoop=function(){this.animationLoopStopped=!0},WebAdapter.prototype.loop=function(){var a=this,b=function(){a.animationLoopStopped||(a.animationFunction(),requestAnimationFrame(b))};b()},WebAdapter.prototype.uploadGlTexture=function(a,b,c){c instanceof ImageData||c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b.w,b.h,0,a.RGBA,a.UNSIGNED_BYTE,c)},WebAdapter.prototype.loadTextureSourceString=function(a,b){var c=new Image;"data:"!=a.substr(0,5)&&(c.crossOrigin="Anonymous"),c.onload=function(){b(c,{renderInfo:{src:a}})},c.src=a},WebAdapter.prototype.getHrTime=function(){return window.performance?window.performance.now():(new Date).getTime()},WebAdapter.prototype.getWebGLRenderingContext=function(a,b){var c;c=this.stage.reuseCanvas?this.stage.reuseCanvas:document.createElement("canvas"),c.width=a,c.height=b;var d={alpha:!0,antialias:!1,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1},e=c.getContext("webgl",d)||c.getContext("experimental-webgl",d);if(!e)throw new Error("This browser does not support webGL.");return this.canvas=c,e},WebAdapter.prototype.getDrawingCanvas=function(){return this.textCanvas||(this.textCanvas=document.createElement("canvas")),this.textCanvas},WebAdapter.prototype.getUComponentContext=function(){return this.uComponentContext},WebAdapter.prototype.nextFrame=function(a){};